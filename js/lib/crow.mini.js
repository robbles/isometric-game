var COMPILED=false;var goog=goog||{};goog.global=this;goog.DEBUG=true;goog.LOCALE="en";goog.evalWorksForGlobals_=null;goog.provide=function(name){if(!COMPILED){if(goog.getObjectByName(name)&&!goog.implicitNamespaces_[name])throw Error('Namespace "'+name+'" already declared.');var namespace=name;while(namespace=namespace.substring(0,namespace.lastIndexOf(".")))goog.implicitNamespaces_[namespace]=true}goog.exportPath_(name)};if(!COMPILED)goog.implicitNamespaces_={};
goog.exportPath_=function(name,opt_object,opt_objectToExportTo){var parts=name.split(".");var cur=opt_objectToExportTo||goog.global;if(!(parts[0]in cur)&&cur.execScript)cur.execScript("var "+parts[0]);for(var part;parts.length&&(part=parts.shift());)if(!parts.length&&goog.isDef(opt_object))cur[part]=opt_object;else if(cur[part])cur=cur[part];else cur=cur[part]={}};
goog.getObjectByName=function(name,opt_obj){var parts=name.split(".");var cur=opt_obj||goog.global;for(var part;part=parts.shift();)if(cur[part])cur=cur[part];else return null;return cur};goog.globalize=function(obj,opt_global){var global=opt_global||goog.global;for(var x in obj)global[x]=obj[x]};
goog.addDependency=function(relPath,provides,requires){if(!COMPILED){var provide,require;var path=relPath.replace(/\\/g,"/");var deps=goog.dependencies_;for(var i=0;provide=provides[i];i++){deps.nameToPath[provide]=path;if(!(path in deps.pathToNames))deps.pathToNames[path]={};deps.pathToNames[path][provide]=true}for(var j=0;require=requires[j];j++){if(!(path in deps.requires))deps.requires[path]={};deps.requires[path][require]=true}}};
goog.require=function(rule){if(!COMPILED){if(goog.getObjectByName(rule))return;var path=goog.getPathFromDeps_(rule);if(path){goog.included_[path]=true;goog.writeScripts_()}else{var errorMessage="goog.require could not find: "+rule;if(goog.global.console)goog.global.console["error"](errorMessage);throw Error(errorMessage);}}};goog.basePath="";goog.global.CLOSURE_BASE_PATH;goog.global.CLOSURE_NO_DEPS;goog.nullFunction=function(){};goog.identityFunction=function(var_args){return arguments[0]};
goog.abstractMethod=function(){throw Error("unimplemented abstract method");};goog.addSingletonGetter=function(ctor){ctor.getInstance=function(){return ctor.instance_||(ctor.instance_=new ctor)}};
if(!COMPILED){goog.included_={};goog.dependencies_={pathToNames:{},nameToPath:{},requires:{},visited:{},written:{}};goog.inHtmlDocument_=function(){var doc=goog.global.document;return typeof doc!="undefined"&&"write"in doc};goog.findBasePath_=function(){if(!goog.inHtmlDocument_())return;var doc=goog.global.document;if(goog.global.CLOSURE_BASE_PATH){goog.basePath=goog.global.CLOSURE_BASE_PATH;return}var scripts=doc.getElementsByTagName("script");for(var i=scripts.length-1;i>=0;--i){var src=scripts[i].src;
var l=src.length;if(src.substr(l-7)=="base.js"){goog.basePath=src.substr(0,l-7);return}}};goog.writeScriptTag_=function(src){if(goog.inHtmlDocument_()&&!goog.dependencies_.written[src]){goog.dependencies_.written[src]=true;var doc=goog.global.document;doc.write('<script type="text/javascript" src="'+src+'"></'+"script>")}};goog.writeScripts_=function(){var scripts=[];var seenScript={};var deps=goog.dependencies_;function visitNode(path){if(path in deps.written)return;if(path in deps.visited){if(!(path in
seenScript)){seenScript[path]=true;scripts.push(path)}return}deps.visited[path]=true;if(path in deps.requires)for(var requireName in deps.requires[path])if(requireName in deps.nameToPath)visitNode(deps.nameToPath[requireName]);else if(!goog.getObjectByName(requireName))throw Error("Undefined nameToPath for "+requireName);if(!(path in seenScript)){seenScript[path]=true;scripts.push(path)}}for(var path in goog.included_)if(!deps.written[path])visitNode(path);for(var i=0;i<scripts.length;i++)if(scripts[i])goog.writeScriptTag_(goog.basePath+
scripts[i]);else throw Error("Undefined script input");};goog.getPathFromDeps_=function(rule){if(rule in goog.dependencies_.nameToPath)return goog.dependencies_.nameToPath[rule];else return null};goog.findBasePath_();if(!goog.global.CLOSURE_NO_DEPS)goog.writeScriptTag_(goog.basePath+"deps.js")}
goog.typeOf=function(value){var s=typeof value;if(s=="object")if(value){if(value instanceof Array||!(value instanceof Object)&&Object.prototype.toString.call(value)=="[object Array]"||typeof value.length=="number"&&typeof value.splice!="undefined"&&typeof value.propertyIsEnumerable!="undefined"&&!value.propertyIsEnumerable("splice"))return"array";if(!(value instanceof Object)&&(Object.prototype.toString.call(value)=="[object Function]"||typeof value.call!="undefined"&&typeof value.propertyIsEnumerable!=
"undefined"&&!value.propertyIsEnumerable("call")))return"function"}else return"null";else if(s=="function"&&typeof value.call=="undefined")return"object";return s};goog.propertyIsEnumerableCustom_=function(object,propName){if(propName in object)for(var key in object)if(key==propName&&Object.prototype.hasOwnProperty.call(object,propName))return true;return false};
goog.propertyIsEnumerable_=function(object,propName){if(object instanceof Object)return Object.prototype.propertyIsEnumerable.call(object,propName);else return goog.propertyIsEnumerableCustom_(object,propName)};goog.isDef=function(val){return val!==undefined};goog.isNull=function(val){return val===null};goog.isDefAndNotNull=function(val){return val!=null};goog.isArray=function(val){return goog.typeOf(val)=="array"};
goog.isArrayLike=function(val){var type=goog.typeOf(val);return type=="array"||type=="object"&&typeof val.length=="number"};goog.isDateLike=function(val){return goog.isObject(val)&&typeof val.getFullYear=="function"};goog.isString=function(val){return typeof val=="string"};goog.isBoolean=function(val){return typeof val=="boolean"};goog.isNumber=function(val){return typeof val=="number"};goog.isFunction=function(val){return goog.typeOf(val)=="function"};
goog.isObject=function(val){var type=goog.typeOf(val);return type=="object"||type=="array"||type=="function"};goog.getUid=function(obj){return obj[goog.UID_PROPERTY_]||(obj[goog.UID_PROPERTY_]=++goog.uidCounter_)};goog.removeUid=function(obj){if("removeAttribute"in obj)obj.removeAttribute(goog.UID_PROPERTY_);try{delete obj[goog.UID_PROPERTY_]}catch(ex){}};goog.UID_PROPERTY_="closure_uid_"+Math.floor(Math.random()*2147483648).toString(36);goog.uidCounter_=0;goog.getHashCode=goog.getUid;
goog.removeHashCode=goog.removeUid;goog.cloneObject=function(obj){var type=goog.typeOf(obj);if(type=="object"||type=="array"){if(obj.clone)return obj.clone();var clone=type=="array"?[]:{};for(var key in obj)clone[key]=goog.cloneObject(obj[key]);return clone}return obj};Object.prototype.clone;
goog.bind=function(fn,selfObj,var_args){var context=selfObj||goog.global;if(arguments.length>2){var boundArgs=Array.prototype.slice.call(arguments,2);return function(){var newArgs=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(newArgs,boundArgs);return fn.apply(context,newArgs)}}else return function(){return fn.apply(context,arguments)}};
goog.partial=function(fn,var_args){var args=Array.prototype.slice.call(arguments,1);return function(){var newArgs=Array.prototype.slice.call(arguments);newArgs.unshift.apply(newArgs,args);return fn.apply(this,newArgs)}};goog.mixin=function(target,source){for(var x in source)target[x]=source[x]};goog.now=Date.now||function(){return+new Date};
goog.globalEval=function(script){if(goog.global.execScript)goog.global.execScript(script,"JavaScript");else if(goog.global.eval){if(goog.evalWorksForGlobals_==null){goog.global.eval("var _et_ = 1;");if(typeof goog.global["_et_"]!="undefined"){delete goog.global["_et_"];goog.evalWorksForGlobals_=true}else goog.evalWorksForGlobals_=false}if(goog.evalWorksForGlobals_)goog.global.eval(script);else{var doc=goog.global.document;var scriptElt=doc.createElement("script");scriptElt.type="text/javascript";
scriptElt.defer=false;scriptElt.appendChild(doc.createTextNode(script));doc.body.appendChild(scriptElt);doc.body.removeChild(scriptElt)}}else throw Error("goog.globalEval not available");};goog.typedef=true;goog.cssNameMapping_;goog.getCssName=function(className,opt_modifier){var cssName=className+(opt_modifier?"-"+opt_modifier:"");return goog.cssNameMapping_&&cssName in goog.cssNameMapping_?goog.cssNameMapping_[cssName]:cssName};goog.setCssNameMapping=function(mapping){goog.cssNameMapping_=mapping};
goog.getMsg=function(str,opt_values){var values=opt_values||{};for(var key in values){var value=(""+values[key]).replace(/\$/g,"$$$$");str=str.replace(new RegExp("\\{\\$"+key+"\\}","gi"),value)}return str};goog.exportSymbol=function(publicPath,object,opt_objectToExportTo){goog.exportPath_(publicPath,object,opt_objectToExportTo)};goog.exportProperty=function(object,publicName,symbol){object[publicName]=symbol};
goog.inherits=function(childCtor,parentCtor){function tempCtor(){}tempCtor.prototype=parentCtor.prototype;childCtor.superClass_=parentCtor.prototype;childCtor.prototype=new tempCtor;childCtor.prototype.constructor=childCtor};
goog.base=function(me,opt_methodName,var_args){var caller=arguments.callee.caller;if(caller.superClass_)return caller.superClass_.constructor.apply(me,Array.prototype.slice.call(arguments,1));var args=Array.prototype.slice.call(arguments,2);var foundCaller=false;for(var ctor=me.constructor;ctor;ctor=ctor.superClass_&&ctor.superClass_.constructor)if(ctor.prototype[opt_methodName]===caller)foundCaller=true;else if(foundCaller)return ctor.prototype[opt_methodName].apply(me,args);if(me[opt_methodName]===
caller)return me.constructor.prototype[opt_methodName].apply(me,args);else throw Error("goog.base called from a method of one name "+"to a method of a different name");};goog.scope=function(fn){fn.call(goog.global)};goog.provide("crow.util.MonkeyPatches");if(!Array.prototype.indexOf)Array.prototype.indexOf=function(elt){var len=this.length>>>0;var from=Number(arguments[1])||0;from=from<0?Math.ceil(from):Math.floor(from);if(from<0)from+=len;for(;from<len;from++)if(from in this&&this[from]===elt)return from;return-1};if(!Array.prototype.shuffle)Array.prototype.shuffle=function(){var v=this.concat();for(var j,x,i=v.length;i;j=parseInt(Math.random()*i),x=v[--i],v[i]=v[j],v[j]=x);return v};goog.provide("crow.Logger");
(function(){var globalScope=goog.global;var LOG_LEVEL={error:1,warn:2,info:3,debug:4,off:-Infinity};var appender=globalScope.console?console:{};var GLOBAL_LOG_LEVEL=LOG_LEVEL["warn"];crow.Logger=function(klass){this.klass=klass};crow.Logger.prototype.getLogLevel=function(){if(typeof this.klass.LOG_LEVEL!=="undefined")return this.klass.LOG_LEVEL;else return GLOBAL_LOG_LEVEL};crow.Logger.prototype.error=function(){var args=Array.prototype.slice.call(arguments,0);args[0]="Crow Error: "+args[0];if(appender&&
appender.error&&this.getLogLevel()>=1)appender.error.apply(appender,args)};crow.Logger.prototype.warn=function(){var args=Array.prototype.slice.call(arguments,0);args[0]="Crow Warning: "+args[0];if(appender&&appender.warn&&this.getLogLevel()>=2)appender.warn.apply(appender,args)};crow.Logger.prototype.info=function(){var args=Array.prototype.slice.call(arguments,0);args[0]="Crow Info: "+args[0];if(appender&&appender.info&&this.getLogLevel()>=3)appender.info.apply(appender,args)};crow.Logger.prototype.debug=
function(){var args=Array.prototype.slice.call(arguments,0);args[0]="Crow Debug: "+args[0];if(appender&&appender.debug&&this.getLogLevel()>=4)appender.debug.apply(appender,args)};crow.Logger.prototype.setLevel=function(level){return crow.Logger.setLevel(level,this.klass)};crow.Logger.setLevel=function(level,klass){var newLevel=LOG_LEVEL[level.toLowerCase()];if(typeof newLevel!=="number")throw new Error("Invalid log level: "+level);if(klass)klass.LOG_LEVEL=newLevel;else GLOBAL_LOG_LEVEL=newLevel};
crow.Logger.setAppender=function(newAppender){appender=newAppender}})();goog.provide("crow.util.Assert");crow.assert=function(bool,msg){if(!bool)throw new Error(msg);};crow.assert.InvalidArgumentType=function(expectedType){return"Invalid argument type, expected "+expectedType};crow.assert.IncorrectArgumentCount=function(actualCount,expectedCount){return"Incorrect argument count, got "+actualCount+" but expected "+expectedCount};crow.assert.IndexOutBounds=function(number){return"Index out of bounds (<0 or >length), was "+number};
crow.assert.AbstractMethod=function(methodName){return"Method "+methodName+" is abstract; must be overridden"};crow.assert.IllegalMethodCall=function(methodName,msg){return"Method `"+methodName+"` cannot be called here: "+msg};goog.provide("crow.structs.BucketPriorityQueue");crow.structs.BucketPriorityQueue=function(key_comparator){this.arr=[];this.length=0;if(key_comparator)this.key_comparator=key_comparator;else this.key_comparator=crow.structs.BucketPriorityQueue.DEFAULT_KEY_COMPARATOR};crow.structs.BucketPriorityQueue.DEFAULT_KEY_COMPARATOR=function(k1,k2){if(k1<k2)return-1;if(k1>k2)return 1;return 0};crow.structs.BucketPriorityQueue.REVERSE_KEY_COMPARATOR=function(k2,k1){if(k1<k2)return-1;if(k1>k2)return 1;return 0};
crow.structs.BucketPriorityQueue.prototype.enqueue=function(key,value){this.findBucket(key,true).push(value);this.length++};crow.structs.BucketPriorityQueue.prototype.dequeue=function(){var element;if(this.length){var bucket=this.arr[0];element=bucket.shift();if(!bucket.length)this.arr.shift();this.length--}return element};
crow.structs.BucketPriorityQueue.prototype.contains=function(value,key_hint){if(key_hint)throw new Error("not implemented yet");else for(var i=0;i<this.arr.length;i++){var bucket=this.arr[i];for(var j=0;j<bucket.length;j++){var bucketValue=bucket[j];if(bucketValue==value)return true}}return false};
crow.structs.BucketPriorityQueue.prototype.getPriority=function(value){for(var i=0;i<this.arr.length;i++){var bucket=this.arr[i];for(var j=0;j<bucket.length;j++){var bucketValue=bucket[j];if(bucketValue==value)return bucket.key}}return null};
crow.structs.BucketPriorityQueue.prototype.remove=function(value,key_hint){if(key_hint)throw new Error("not implemented yet");else{for(var i=0;i<this.arr.length;i++){var bucket=this.arr[i];for(var j=0;j<bucket.length;j++){var bucketValue=bucket[j];if(bucketValue==value){bucket.splice(j,1);if(!bucket.length)this.arr.splice(i,1);this.length--;return bucketValue}}}return undefined}};crow.structs.BucketPriorityQueue.prototype.peek=function(){if(this.length)return this.arr[0][0]};
crow.structs.BucketPriorityQueue.prototype.peekKey=function(){if(this.length)return this.arr[0].key};crow.structs.BucketPriorityQueue.prototype.each=function(callback){for(var i=0;i<this.arr.length;i++){var bucket=this.arr[i];if(bucket)for(var j=0;j<bucket.length;j++)callback(bucket[j],i)}};
crow.structs.BucketPriorityQueue.prototype.findBucket=function(key,createIfNotFound){var bucket;var kc=this.key_comparator;var lowerBound=0,upperBound=this.arr.length-1;var min=0,max=this.arr.length-1,mid,comp;while(min<=max){mid=min+Math.floor((max-min)/2);var currentBucket=this.arr[mid];comp=kc(currentBucket.key,key);if(comp<0)min=mid+1;else if(comp>0)max=mid-1;else{bucket=currentBucket;break}}if(!bucket&&createIfNotFound){bucket=[];bucket.key=key;var inserted=false;for(var i=mid;i<this.arr.length&&
!inserted;i++)if(kc(this.arr[i].key,key)>0){this.arr.splice(i,0,bucket);inserted=true}if(!inserted)this.arr.push(bucket)}return bucket};goog.provide("crow.Algorithm");goog.require("crow.structs.BucketPriorityQueue");crow.Algorithm=function(){};crow.Algorithm.wrapperNodeGetterTemplate=function(klass){return function(node){if(node instanceof klass)return node;var w=this.wrapperNode.get(node);if(w)return w;w=new klass(node);w.algorithm=this;this.wrapperNode.set(node,w);return w}};
crow.Algorithm.prototype._invalidatePoint=function(path,invalidationEvent){var x=invalidationEvent.x,y=invalidationEvent.y;for(var i=0;i<path.nodes.length;i++){var n=path.nodes[i];if(n.x==x&&n.y==y){path.nodes=path.nodes.slice(0,1);path.end=null;path.found=false;break}}};
crow.Algorithm.prototype._invalidateRegion=function(path,invalidationEvent){var x=invalidationEvent.x,y=invalidationEvent.y;var x2=x+invalidationEvent.dx,y2=y+invalidationEvent.dy;for(var i=0;i<path.nodes.length;i++){var n=path.nodes[i];var nx=n.x,ny=n.y;if(nx>=x&&ny>=y&&nx<x2&&ny<y2){path.nodes=path.nodes.slice(0,1);path.end=null;path.found=false;break}}};
crow.Algorithm.prototype.continueCalculating=function(path,count){var lastNode=path.nodes[path.nodes.length-1];if(!lastNode)lastNode=path.start;var opts={};if(count)opts.limit=count;if(path.actor)opts.actor=path.actor;var continuedPath=this.findPath(lastNode,path.goal,opts);path.nodes=path.nodes.concat(continuedPath.nodes.slice(1)),path.found=continuedPath.found;return path.found};
crow.Algorithm.NodeMap=function(defaultValue){var map={};this.get=function(node){var val=map[node.id];return typeof val!=="undefined"?val:defaultValue};this.set=function(node,val){map[node.id]=val}};crow.Algorithm.PriorityQueue=function(){throw new Error("A PriorityQueue class is required, but none found!");};crow.Algorithm.initializeDataStructures=function(){crow.Algorithm.PriorityQueue=crow.structs.BucketPriorityQueue;crow.Algorithm.initializeDataStructures=function(){}};goog.provide("goog.Disposable");goog.provide("goog.dispose");goog.Disposable=function(){};goog.Disposable.prototype.disposed_=false;goog.Disposable.prototype.isDisposed=function(){return this.disposed_};goog.Disposable.prototype.getDisposed=goog.Disposable.prototype.isDisposed;goog.Disposable.prototype.dispose=function(){if(!this.disposed_){this.disposed_=true;this.disposeInternal()}};goog.Disposable.prototype.disposeInternal=function(){};goog.dispose=function(obj){if(obj&&typeof obj.dispose=="function")obj.dispose()};goog.provide("goog.debug.Error");goog.debug.Error=function(opt_msg){this.stack=(new Error).stack||"";if(opt_msg)this.message=String(opt_msg)};goog.inherits(goog.debug.Error,Error);goog.debug.Error.prototype.name="CustomError";goog.provide("goog.string");goog.provide("goog.string.Unicode");goog.string.Unicode={NBSP:"\u00a0"};goog.string.startsWith=function(str,prefix){return str.lastIndexOf(prefix,0)==0};goog.string.endsWith=function(str,suffix){var l=str.length-suffix.length;return l>=0&&str.indexOf(suffix,l)==l};goog.string.caseInsensitiveStartsWith=function(str,prefix){return goog.string.caseInsensitiveCompare(prefix,str.substr(0,prefix.length))==0};
goog.string.caseInsensitiveEndsWith=function(str,suffix){return goog.string.caseInsensitiveCompare(suffix,str.substr(str.length-suffix.length,suffix.length))==0};goog.string.subs=function(str,var_args){for(var i=1;i<arguments.length;i++){var replacement=String(arguments[i]).replace(/\$/g,"$$$$");str=str.replace(/\%s/,replacement)}return str};goog.string.collapseWhitespace=function(str){return str.replace(/[\s\xa0]+/g," ").replace(/^\s+|\s+$/g,"")};goog.string.isEmpty=function(str){return/^[\s\xa0]*$/.test(str)};
goog.string.isEmptySafe=function(str){return goog.string.isEmpty(goog.string.makeSafe(str))};goog.string.isBreakingWhitespace=function(str){return!/[^\t\n\r ]/.test(str)};goog.string.isAlpha=function(str){return!/[^a-zA-Z]/.test(str)};goog.string.isNumeric=function(str){return!/[^0-9]/.test(str)};goog.string.isAlphaNumeric=function(str){return!/[^a-zA-Z0-9]/.test(str)};goog.string.isSpace=function(ch){return ch==" "};
goog.string.isUnicodeChar=function(ch){return ch.length==1&&ch>=" "&&ch<="~"||ch>="\u0080"&&ch<="\ufffd"};goog.string.stripNewlines=function(str){return str.replace(/(\r\n|\r|\n)+/g," ")};goog.string.canonicalizeNewlines=function(str){return str.replace(/(\r\n|\r|\n)/g,"\n")};goog.string.normalizeWhitespace=function(str){return str.replace(/\xa0|\s/g," ")};goog.string.normalizeSpaces=function(str){return str.replace(/\xa0|[ \t]+/g," ")};
goog.string.trim=function(str){return str.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")};goog.string.trimLeft=function(str){return str.replace(/^[\s\xa0]+/,"")};goog.string.trimRight=function(str){return str.replace(/[\s\xa0]+$/,"")};goog.string.caseInsensitiveCompare=function(str1,str2){var test1=String(str1).toLowerCase();var test2=String(str2).toLowerCase();if(test1<test2)return-1;else if(test1==test2)return 0;else return 1};goog.string.numerateCompareRegExp_=/(\.\d+)|(\d+)|(\D+)/g;
goog.string.numerateCompare=function(str1,str2){if(str1==str2)return 0;if(!str1)return-1;if(!str2)return 1;var tokens1=str1.toLowerCase().match(goog.string.numerateCompareRegExp_);var tokens2=str2.toLowerCase().match(goog.string.numerateCompareRegExp_);var count=Math.min(tokens1.length,tokens2.length);for(var i=0;i<count;i++){var a=tokens1[i];var b=tokens2[i];if(a!=b){var num1=parseInt(a,10);if(!isNaN(num1)){var num2=parseInt(b,10);if(!isNaN(num2)&&num1-num2)return num1-num2}return a<b?-1:1}}if(tokens1.length!=
tokens2.length)return tokens1.length-tokens2.length;return str1<str2?-1:1};goog.string.encodeUriRegExp_=/^[a-zA-Z0-9\-_.!~*'()]*$/;goog.string.urlEncode=function(str){str=String(str);if(!goog.string.encodeUriRegExp_.test(str))return encodeURIComponent(str);return str};goog.string.urlDecode=function(str){return decodeURIComponent(str.replace(/\+/g," "))};goog.string.newLineToBr=function(str,opt_xml){return str.replace(/(\r\n|\r|\n)/g,opt_xml?"<br />":"<br>")};
goog.string.htmlEscape=function(str,opt_isLikelyToContainHtmlChars){if(opt_isLikelyToContainHtmlChars)return str.replace(goog.string.amperRe_,"&amp;").replace(goog.string.ltRe_,"&lt;").replace(goog.string.gtRe_,"&gt;").replace(goog.string.quotRe_,"&quot;");else{if(!goog.string.allRe_.test(str))return str;if(str.indexOf("&")!=-1)str=str.replace(goog.string.amperRe_,"&amp;");if(str.indexOf("<")!=-1)str=str.replace(goog.string.ltRe_,"&lt;");if(str.indexOf(">")!=-1)str=str.replace(goog.string.gtRe_,"&gt;");
if(str.indexOf('"')!=-1)str=str.replace(goog.string.quotRe_,"&quot;");return str}};goog.string.amperRe_=/&/g;goog.string.ltRe_=/</g;goog.string.gtRe_=/>/g;goog.string.quotRe_=/\"/g;goog.string.allRe_=/[&<>\"]/;goog.string.unescapeEntities=function(str){if(goog.string.contains(str,"&"))if("document"in goog.global&&!goog.string.contains(str,"<"))return goog.string.unescapeEntitiesUsingDom_(str);else return goog.string.unescapePureXmlEntities_(str);return str};
goog.string.unescapeEntitiesUsingDom_=function(str){var el=goog.global["document"]["createElement"]("div");el["innerHTML"]="<pre>x"+str+"</pre>";if(el["firstChild"][goog.string.NORMALIZE_FN_])el["firstChild"][goog.string.NORMALIZE_FN_]();str=el["firstChild"]["firstChild"]["nodeValue"].slice(1);el["innerHTML"]="";return goog.string.canonicalizeNewlines(str)};
goog.string.unescapePureXmlEntities_=function(str){return str.replace(/&([^;]+);/g,function(s,entity){switch(entity){case "amp":return"&";case "lt":return"<";case "gt":return">";case "quot":return'"';default:if(entity.charAt(0)=="#"){var n=Number("0"+entity.substr(1));if(!isNaN(n))return String.fromCharCode(n)}return s}})};goog.string.NORMALIZE_FN_="normalize";goog.string.whitespaceEscape=function(str,opt_xml){return goog.string.newLineToBr(str.replace(/  /g," &#160;"),opt_xml)};
goog.string.stripQuotes=function(str,quoteChars){var length=quoteChars.length;for(var i=0;i<length;i++){var quoteChar=length==1?quoteChars:quoteChars.charAt(i);if(str.charAt(0)==quoteChar&&str.charAt(str.length-1)==quoteChar)return str.substring(1,str.length-1)}return str};
goog.string.truncate=function(str,chars,opt_protectEscapedCharacters){if(opt_protectEscapedCharacters)str=goog.string.unescapeEntities(str);if(str.length>chars)str=str.substring(0,chars-3)+"...";if(opt_protectEscapedCharacters)str=goog.string.htmlEscape(str);return str};
goog.string.truncateMiddle=function(str,chars,opt_protectEscapedCharacters){if(opt_protectEscapedCharacters)str=goog.string.unescapeEntities(str);if(str.length>chars){var half=Math.floor(chars/2);var endPos=str.length-half;half+=chars%2;str=str.substring(0,half)+"..."+str.substring(endPos)}if(opt_protectEscapedCharacters)str=goog.string.htmlEscape(str);return str};
goog.string.specialEscapeChars_={"\u0000":"\\0","\u0008":"\\b","\u000c":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\u000b":"\\x0B",'"':'\\"',"\\":"\\\\"};goog.string.jsEscapeCache_={"'":"\\'"};goog.string.quote=function(s){s=String(s);if(s.quote)return s.quote();else{var sb=['"'];for(var i=0;i<s.length;i++){var ch=s.charAt(i);var cc=ch.charCodeAt(0);sb[i+1]=goog.string.specialEscapeChars_[ch]||(cc>31&&cc<127?ch:goog.string.escapeChar(ch))}sb.push('"');return sb.join("")}};
goog.string.escapeString=function(str){var sb=[];for(var i=0;i<str.length;i++)sb[i]=goog.string.escapeChar(str.charAt(i));return sb.join("")};
goog.string.escapeChar=function(c){if(c in goog.string.jsEscapeCache_)return goog.string.jsEscapeCache_[c];if(c in goog.string.specialEscapeChars_)return goog.string.jsEscapeCache_[c]=goog.string.specialEscapeChars_[c];var rv=c;var cc=c.charCodeAt(0);if(cc>31&&cc<127)rv=c;else{if(cc<256){rv="\\x";if(cc<16||cc>256)rv+="0"}else{rv="\\u";if(cc<4096)rv+="0"}rv+=cc.toString(16).toUpperCase()}return goog.string.jsEscapeCache_[c]=rv};
goog.string.toMap=function(s){var rv={};for(var i=0;i<s.length;i++)rv[s.charAt(i)]=true;return rv};goog.string.contains=function(s,ss){return s.indexOf(ss)!=-1};goog.string.removeAt=function(s,index,stringLength){var resultStr=s;if(index>=0&&index<s.length&&stringLength>0)resultStr=s.substr(0,index)+s.substr(index+stringLength,s.length-index-stringLength);return resultStr};goog.string.remove=function(s,ss){var re=new RegExp(goog.string.regExpEscape(ss),"");return s.replace(re,"")};
goog.string.removeAll=function(s,ss){var re=new RegExp(goog.string.regExpEscape(ss),"g");return s.replace(re,"")};goog.string.regExpEscape=function(s){return String(s).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")};goog.string.repeat=function(string,length){return(new Array(length+1)).join(string)};
goog.string.padNumber=function(num,length,opt_precision){var s=goog.isDef(opt_precision)?num.toFixed(opt_precision):String(num);var index=s.indexOf(".");if(index==-1)index=s.length;return goog.string.repeat("0",Math.max(0,length-index))+s};goog.string.makeSafe=function(obj){return obj==null?"":String(obj)};goog.string.buildString=function(var_args){return Array.prototype.join.call(arguments,"")};
goog.string.getRandomString=function(){return Math.floor(Math.random()*2147483648).toString(36)+(Math.floor(Math.random()*2147483648)^goog.now()).toString(36)};
goog.string.compareVersions=function(version1,version2){var order=0;var v1Subs=goog.string.trim(String(version1)).split(".");var v2Subs=goog.string.trim(String(version2)).split(".");var subCount=Math.max(v1Subs.length,v2Subs.length);for(var subIdx=0;order==0&&subIdx<subCount;subIdx++){var v1Sub=v1Subs[subIdx]||"";var v2Sub=v2Subs[subIdx]||"";var v1CompParser=new RegExp("(\\d*)(\\D*)","g");var v2CompParser=new RegExp("(\\d*)(\\D*)","g");do{var v1Comp=v1CompParser.exec(v1Sub)||["","",""];var v2Comp=
v2CompParser.exec(v2Sub)||["","",""];if(v1Comp[0].length==0&&v2Comp[0].length==0)break;var v1CompNum=v1Comp[1].length==0?0:parseInt(v1Comp[1],10);var v2CompNum=v2Comp[1].length==0?0:parseInt(v2Comp[1],10);order=goog.string.compareElements_(v1CompNum,v2CompNum)||goog.string.compareElements_(v1Comp[2].length==0,v2Comp[2].length==0)||goog.string.compareElements_(v1Comp[2],v2Comp[2])}while(order==0)}return order};
goog.string.compareElements_=function(left,right){if(left<right)return-1;else if(left>right)return 1;return 0};goog.string.HASHCODE_MAX_=4294967296;goog.string.hashCode=function(str){var result=0;for(var i=0;i<str.length;++i){result=31*result+str.charCodeAt(i);result%=goog.string.HASHCODE_MAX_}return result};goog.string.uniqueStringCounter_=Math.random()*2147483648|0;goog.string.createUniqueString=function(){return"goog_"+goog.string.uniqueStringCounter_++};
goog.string.toNumber=function(str){var num=Number(str);if(num==0&&goog.string.isEmpty(str))return NaN;return num};goog.provide("goog.asserts");goog.provide("goog.asserts.AssertionError");goog.require("goog.debug.Error");goog.require("goog.string");goog.asserts.ENABLE_ASSERTS=goog.DEBUG;goog.asserts.AssertionError=function(messagePattern,messageArgs){messageArgs.unshift(messagePattern);goog.debug.Error.call(this,goog.string.subs.apply(null,messageArgs));messageArgs.shift();this.messagePattern=messagePattern};goog.inherits(goog.asserts.AssertionError,goog.debug.Error);
goog.asserts.AssertionError.prototype.name="AssertionError";goog.asserts.doAssertFailure_=function(defaultMessage,defaultArgs,givenMessage,givenArgs){var message="Assertion failed";if(givenMessage){message+=": "+givenMessage;var args=givenArgs}else if(defaultMessage){message+=": "+defaultMessage;args=defaultArgs}throw new goog.asserts.AssertionError(""+message,args||[]);};
goog.asserts.assert=function(condition,opt_message,var_args){if(goog.asserts.ENABLE_ASSERTS&&!condition)goog.asserts.doAssertFailure_("",null,opt_message,Array.prototype.slice.call(arguments,2));return condition};goog.asserts.fail=function(opt_message,var_args){if(goog.asserts.ENABLE_ASSERTS)throw new goog.asserts.AssertionError("Failure"+(opt_message?": "+opt_message:""),Array.prototype.slice.call(arguments,1));};
goog.asserts.assertNumber=function(value,opt_message,var_args){if(goog.asserts.ENABLE_ASSERTS&&!goog.isNumber(value))goog.asserts.doAssertFailure_("Expected number but got %s: %s.",[goog.typeOf(value),value],opt_message,Array.prototype.slice.call(arguments,2));return value};
goog.asserts.assertString=function(value,opt_message,var_args){if(goog.asserts.ENABLE_ASSERTS&&!goog.isString(value))goog.asserts.doAssertFailure_("Expected string but got %s: %s.",[goog.typeOf(value),value],opt_message,Array.prototype.slice.call(arguments,2));return value};
goog.asserts.assertFunction=function(value,opt_message,var_args){if(goog.asserts.ENABLE_ASSERTS&&!goog.isFunction(value))goog.asserts.doAssertFailure_("Expected function but got %s: %s.",[goog.typeOf(value),value],opt_message,Array.prototype.slice.call(arguments,2));return value};
goog.asserts.assertObject=function(value,opt_message,var_args){if(goog.asserts.ENABLE_ASSERTS&&!goog.isObject(value))goog.asserts.doAssertFailure_("Expected object but got %s: %s.",[goog.typeOf(value),value],opt_message,Array.prototype.slice.call(arguments,2));return value};
goog.asserts.assertArray=function(value,opt_message,var_args){if(goog.asserts.ENABLE_ASSERTS&&!goog.isArray(value))goog.asserts.doAssertFailure_("Expected array but got %s: %s.",[goog.typeOf(value),value],opt_message,Array.prototype.slice.call(arguments,2));return value};
goog.asserts.assertBoolean=function(value,opt_message,var_args){if(goog.asserts.ENABLE_ASSERTS&&!goog.isBoolean(value))goog.asserts.doAssertFailure_("Expected boolean but got %s: %s.",[goog.typeOf(value),value],opt_message,Array.prototype.slice.call(arguments,2));return value};
goog.asserts.assertInstanceof=function(value,type,opt_message,var_args){if(goog.asserts.ENABLE_ASSERTS&&!(value instanceof type))goog.asserts.doAssertFailure_("instanceof check failed.",null,opt_message,Array.prototype.slice.call(arguments,3))};goog.provide("goog.array");goog.require("goog.asserts");goog.array.ArrayLike;goog.array.peek=function(array){return array[array.length-1]};goog.array.ARRAY_PROTOTYPE_=Array.prototype;
goog.array.indexOf=goog.array.ARRAY_PROTOTYPE_.indexOf?function(arr,obj,opt_fromIndex){goog.asserts.assert(arr.length!=null);return goog.array.ARRAY_PROTOTYPE_.indexOf.call(arr,obj,opt_fromIndex)}:function(arr,obj,opt_fromIndex){var fromIndex=opt_fromIndex==null?0:opt_fromIndex<0?Math.max(0,arr.length+opt_fromIndex):opt_fromIndex;if(goog.isString(arr)){if(!goog.isString(obj)||obj.length!=1)return-1;return arr.indexOf(obj,fromIndex)}for(var i=fromIndex;i<arr.length;i++)if(i in arr&&arr[i]===obj)return i;
return-1};
goog.array.lastIndexOf=goog.array.ARRAY_PROTOTYPE_.lastIndexOf?function(arr,obj,opt_fromIndex){goog.asserts.assert(arr.length!=null);var fromIndex=opt_fromIndex==null?arr.length-1:opt_fromIndex;return goog.array.ARRAY_PROTOTYPE_.lastIndexOf.call(arr,obj,fromIndex)}:function(arr,obj,opt_fromIndex){var fromIndex=opt_fromIndex==null?arr.length-1:opt_fromIndex;if(fromIndex<0)fromIndex=Math.max(0,arr.length+fromIndex);if(goog.isString(arr)){if(!goog.isString(obj)||obj.length!=1)return-1;return arr.lastIndexOf(obj,fromIndex)}for(var i=
fromIndex;i>=0;i--)if(i in arr&&arr[i]===obj)return i;return-1};goog.array.forEach=goog.array.ARRAY_PROTOTYPE_.forEach?function(arr,f,opt_obj){goog.asserts.assert(arr.length!=null);goog.array.ARRAY_PROTOTYPE_.forEach.call(arr,f,opt_obj)}:function(arr,f,opt_obj){var l=arr.length;var arr2=goog.isString(arr)?arr.split(""):arr;for(var i=0;i<l;i++)if(i in arr2)f.call(opt_obj,arr2[i],i,arr)};
goog.array.forEachRight=function(arr,f,opt_obj){var l=arr.length;var arr2=goog.isString(arr)?arr.split(""):arr;for(var i=l-1;i>=0;--i)if(i in arr2)f.call(opt_obj,arr2[i],i,arr)};
goog.array.filter=goog.array.ARRAY_PROTOTYPE_.filter?function(arr,f,opt_obj){goog.asserts.assert(arr.length!=null);return goog.array.ARRAY_PROTOTYPE_.filter.call(arr,f,opt_obj)}:function(arr,f,opt_obj){var l=arr.length;var res=[];var resLength=0;var arr2=goog.isString(arr)?arr.split(""):arr;for(var i=0;i<l;i++)if(i in arr2){var val=arr2[i];if(f.call(opt_obj,val,i,arr))res[resLength++]=val}return res};
goog.array.map=goog.array.ARRAY_PROTOTYPE_.map?function(arr,f,opt_obj){goog.asserts.assert(arr.length!=null);return goog.array.ARRAY_PROTOTYPE_.map.call(arr,f,opt_obj)}:function(arr,f,opt_obj){var l=arr.length;var res=new Array(l);var arr2=goog.isString(arr)?arr.split(""):arr;for(var i=0;i<l;i++)if(i in arr2)res[i]=f.call(opt_obj,arr2[i],i,arr);return res};
goog.array.reduce=function(arr,f,val,opt_obj){if(arr.reduce)if(opt_obj)return arr.reduce(goog.bind(f,opt_obj),val);else return arr.reduce(f,val);var rval=val;goog.array.forEach(arr,function(val,index){rval=f.call(opt_obj,rval,val,index,arr)});return rval};
goog.array.reduceRight=function(arr,f,val,opt_obj){if(arr.reduceRight)if(opt_obj)return arr.reduceRight(goog.bind(f,opt_obj),val);else return arr.reduceRight(f,val);var rval=val;goog.array.forEachRight(arr,function(val,index){rval=f.call(opt_obj,rval,val,index,arr)});return rval};
goog.array.some=goog.array.ARRAY_PROTOTYPE_.some?function(arr,f,opt_obj){goog.asserts.assert(arr.length!=null);return goog.array.ARRAY_PROTOTYPE_.some.call(arr,f,opt_obj)}:function(arr,f,opt_obj){var l=arr.length;var arr2=goog.isString(arr)?arr.split(""):arr;for(var i=0;i<l;i++)if(i in arr2&&f.call(opt_obj,arr2[i],i,arr))return true;return false};
goog.array.every=goog.array.ARRAY_PROTOTYPE_.every?function(arr,f,opt_obj){goog.asserts.assert(arr.length!=null);return goog.array.ARRAY_PROTOTYPE_.every.call(arr,f,opt_obj)}:function(arr,f,opt_obj){var l=arr.length;var arr2=goog.isString(arr)?arr.split(""):arr;for(var i=0;i<l;i++)if(i in arr2&&!f.call(opt_obj,arr2[i],i,arr))return false;return true};goog.array.find=function(arr,f,opt_obj){var i=goog.array.findIndex(arr,f,opt_obj);return i<0?null:goog.isString(arr)?arr.charAt(i):arr[i]};
goog.array.findIndex=function(arr,f,opt_obj){var l=arr.length;var arr2=goog.isString(arr)?arr.split(""):arr;for(var i=0;i<l;i++)if(i in arr2&&f.call(opt_obj,arr2[i],i,arr))return i;return-1};goog.array.findRight=function(arr,f,opt_obj){var i=goog.array.findIndexRight(arr,f,opt_obj);return i<0?null:goog.isString(arr)?arr.charAt(i):arr[i]};
goog.array.findIndexRight=function(arr,f,opt_obj){var l=arr.length;var arr2=goog.isString(arr)?arr.split(""):arr;for(var i=l-1;i>=0;i--)if(i in arr2&&f.call(opt_obj,arr2[i],i,arr))return i;return-1};goog.array.contains=function(arr,obj){return goog.array.indexOf(arr,obj)>=0};goog.array.isEmpty=function(arr){return arr.length==0};goog.array.clear=function(arr){if(!goog.isArray(arr))for(var i=arr.length-1;i>=0;i--)delete arr[i];arr.length=0};
goog.array.insert=function(arr,obj){if(!goog.array.contains(arr,obj))arr.push(obj)};goog.array.insertAt=function(arr,obj,opt_i){goog.array.splice(arr,opt_i,0,obj)};goog.array.insertArrayAt=function(arr,elementsToAdd,opt_i){goog.partial(goog.array.splice,arr,opt_i,0).apply(null,elementsToAdd)};goog.array.insertBefore=function(arr,obj,opt_obj2){var i;if(arguments.length==2||(i=goog.array.indexOf(arr,opt_obj2))<0)arr.push(obj);else goog.array.insertAt(arr,obj,i)};
goog.array.remove=function(arr,obj){var i=goog.array.indexOf(arr,obj);var rv;if(rv=i>=0)goog.array.removeAt(arr,i);return rv};goog.array.removeAt=function(arr,i){goog.asserts.assert(arr.length!=null);return goog.array.ARRAY_PROTOTYPE_.splice.call(arr,i,1).length==1};goog.array.removeIf=function(arr,f,opt_obj){var i=goog.array.findIndex(arr,f,opt_obj);if(i>=0){goog.array.removeAt(arr,i);return true}return false};
goog.array.concat=function(var_args){return goog.array.ARRAY_PROTOTYPE_.concat.apply(goog.array.ARRAY_PROTOTYPE_,arguments)};goog.array.clone=function(arr){if(goog.isArray(arr))return goog.array.concat(arr);else{var rv=[];for(var i=0,len=arr.length;i<len;i++)rv[i]=arr[i];return rv}};goog.array.toArray=function(object){if(goog.isArray(object))return goog.array.concat(object);return goog.array.clone(object)};
goog.array.extend=function(arr1,var_args){for(var i=1;i<arguments.length;i++){var arr2=arguments[i];var isArrayLike;if(goog.isArray(arr2)||(isArrayLike=goog.isArrayLike(arr2))&&arr2.hasOwnProperty("callee"))arr1.push.apply(arr1,arr2);else if(isArrayLike){var len1=arr1.length;var len2=arr2.length;for(var j=0;j<len2;j++)arr1[len1+j]=arr2[j]}else arr1.push(arr2)}};
goog.array.splice=function(arr,index,howMany,var_args){goog.asserts.assert(arr.length!=null);return goog.array.ARRAY_PROTOTYPE_.splice.apply(arr,goog.array.slice(arguments,1))};goog.array.slice=function(arr,start,opt_end){goog.asserts.assert(arr.length!=null);if(arguments.length<=2)return goog.array.ARRAY_PROTOTYPE_.slice.call(arr,start);else return goog.array.ARRAY_PROTOTYPE_.slice.call(arr,start,opt_end)};
goog.array.removeDuplicates=function(arr,opt_rv){var rv=opt_rv||arr;var seen={},cursorInsert=0,cursorRead=0;while(cursorRead<arr.length){var current=arr[cursorRead++];var uid=goog.isObject(current)?goog.getUid(current):current;if(!Object.prototype.hasOwnProperty.call(seen,uid)){seen[uid]=true;rv[cursorInsert++]=current}}rv.length=cursorInsert};goog.array.binarySearch=function(arr,target,opt_compareFn){return goog.array.binarySearch_(arr,opt_compareFn||goog.array.defaultCompare,false,target)};
goog.array.binarySelect=function(arr,evaluator,opt_obj){return goog.array.binarySearch_(arr,evaluator,true,undefined,opt_obj)};
goog.array.binarySearch_=function(arr,compareFn,isEvaluator,opt_target,opt_selfObj){var left=0;var right=arr.length;var found;while(left<right){var middle=left+right>>1;var compareResult;if(isEvaluator)compareResult=compareFn.call(opt_selfObj,arr[middle],middle,arr);else compareResult=compareFn(opt_target,arr[middle]);if(compareResult>0)left=middle+1;else{right=middle;found=!compareResult}}return found?left:~left};
goog.array.sort=function(arr,opt_compareFn){goog.asserts.assert(arr.length!=null);goog.array.ARRAY_PROTOTYPE_.sort.call(arr,opt_compareFn||goog.array.defaultCompare)};
goog.array.stableSort=function(arr,opt_compareFn){for(var i=0;i<arr.length;i++)arr[i]={index:i,value:arr[i]};var valueCompareFn=opt_compareFn||goog.array.defaultCompare;function stableCompareFn(obj1,obj2){return valueCompareFn(obj1.value,obj2.value)||obj1.index-obj2.index}goog.array.sort(arr,stableCompareFn);for(var i=0;i<arr.length;i++)arr[i]=arr[i].value};
goog.array.sortObjectsByKey=function(arr,key,opt_compareFn){var compare=opt_compareFn||goog.array.defaultCompare;goog.array.sort(arr,function(a,b){return compare(a[key],b[key])})};goog.array.equals=function(arr1,arr2,opt_equalsFn){if(!goog.isArrayLike(arr1)||!goog.isArrayLike(arr2)||arr1.length!=arr2.length)return false;var l=arr1.length;var equalsFn=opt_equalsFn||goog.array.defaultCompareEquality;for(var i=0;i<l;i++)if(!equalsFn(arr1[i],arr2[i]))return false;return true};
goog.array.compare=function(arr1,arr2,opt_equalsFn){return goog.array.equals(arr1,arr2,opt_equalsFn)};goog.array.defaultCompare=function(a,b){return a>b?1:a<b?-1:0};goog.array.defaultCompareEquality=function(a,b){return a===b};goog.array.binaryInsert=function(array,value,opt_compareFn){var index=goog.array.binarySearch(array,value,opt_compareFn);if(index<0){goog.array.insertAt(array,value,-(index+1));return true}return false};
goog.array.binaryRemove=function(array,value,opt_compareFn){var index=goog.array.binarySearch(array,value,opt_compareFn);return index>=0?goog.array.removeAt(array,index):false};goog.array.bucket=function(array,sorter){var buckets={};for(var i=0;i<array.length;i++){var value=array[i];var key=sorter(value,i,array);if(goog.isDef(key)){var bucket=buckets[key]||(buckets[key]=[]);bucket.push(value)}}return buckets};goog.array.repeat=function(value,n){var array=[];for(var i=0;i<n;i++)array[i]=value;return array};
goog.array.flatten=function(var_args){var result=[];for(var i=0;i<arguments.length;i++){var element=arguments[i];if(goog.isArray(element))result.push.apply(result,goog.array.flatten.apply(null,element));else result.push(element)}return result};goog.array.rotate=function(array,n){goog.asserts.assert(array.length!=null);if(array.length){n%=array.length;if(n>0)goog.array.ARRAY_PROTOTYPE_.unshift.apply(array,array.splice(-n,n));else if(n<0)goog.array.ARRAY_PROTOTYPE_.push.apply(array,array.splice(0,-n))}return array};
goog.array.zip=function(var_args){if(!arguments.length)return[];var result=[];for(var i=0;true;i++){var value=[];for(var j=0;j<arguments.length;j++){var arr=arguments[j];if(i>=arr.length)return result;value.push(arr[i])}result.push(value)}};goog.provide("goog.debug.EntryPointMonitor");goog.provide("goog.debug.entryPointRegistry");goog.debug.EntryPointMonitor=function(){};goog.debug.EntryPointMonitor.prototype.wrap;goog.debug.EntryPointMonitor.prototype.unwrap;goog.debug.entryPointRegistry.refList_=[];goog.debug.entryPointRegistry.register=function(callback){goog.debug.entryPointRegistry.refList_[goog.debug.entryPointRegistry.refList_.length]=callback};
goog.debug.entryPointRegistry.monitorAll=function(monitor){var transformer=goog.bind(monitor.wrap,monitor);for(var i=0;i<goog.debug.entryPointRegistry.refList_.length;i++)goog.debug.entryPointRegistry.refList_[i](transformer)};goog.debug.entryPointRegistry.unmonitorAllIfPossible=function(monitor){var transformer=goog.bind(monitor.unwrap,monitor);for(var i=0;i<goog.debug.entryPointRegistry.refList_.length;i++)goog.debug.entryPointRegistry.refList_[i](transformer)};goog.provide("goog.debug.errorHandlerWeakDep");goog.debug.errorHandlerWeakDep={protectEntryPoint:function(fn,opt_tracers){return fn}};goog.provide("goog.userAgent");goog.require("goog.string");goog.userAgent.ASSUME_IE=false;goog.userAgent.ASSUME_GECKO=false;goog.userAgent.ASSUME_WEBKIT=false;goog.userAgent.ASSUME_MOBILE_WEBKIT=false;goog.userAgent.ASSUME_OPERA=false;goog.userAgent.BROWSER_KNOWN_=goog.userAgent.ASSUME_IE||goog.userAgent.ASSUME_GECKO||goog.userAgent.ASSUME_MOBILE_WEBKIT||goog.userAgent.ASSUME_WEBKIT||goog.userAgent.ASSUME_OPERA;
goog.userAgent.getUserAgentString=function(){return goog.global["navigator"]?goog.global["navigator"].userAgent:null};goog.userAgent.getNavigator=function(){return goog.global["navigator"]};
goog.userAgent.init_=function(){goog.userAgent.detectedOpera_=false;goog.userAgent.detectedIe_=false;goog.userAgent.detectedWebkit_=false;goog.userAgent.detectedMobile_=false;goog.userAgent.detectedGecko_=false;var ua;if(!goog.userAgent.BROWSER_KNOWN_&&(ua=goog.userAgent.getUserAgentString())){var navigator=goog.userAgent.getNavigator();goog.userAgent.detectedOpera_=ua.indexOf("Opera")==0;goog.userAgent.detectedIe_=!goog.userAgent.detectedOpera_&&ua.indexOf("MSIE")!=-1;goog.userAgent.detectedWebkit_=
!goog.userAgent.detectedOpera_&&ua.indexOf("WebKit")!=-1;goog.userAgent.detectedMobile_=goog.userAgent.detectedWebkit_&&ua.indexOf("Mobile")!=-1;goog.userAgent.detectedGecko_=!goog.userAgent.detectedOpera_&&!goog.userAgent.detectedWebkit_&&navigator.product=="Gecko"}};if(!goog.userAgent.BROWSER_KNOWN_)goog.userAgent.init_();goog.userAgent.OPERA=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_OPERA:goog.userAgent.detectedOpera_;
goog.userAgent.IE=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_IE:goog.userAgent.detectedIe_;goog.userAgent.GECKO=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_GECKO:goog.userAgent.detectedGecko_;goog.userAgent.WEBKIT=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_WEBKIT||goog.userAgent.ASSUME_MOBILE_WEBKIT:goog.userAgent.detectedWebkit_;goog.userAgent.MOBILE=goog.userAgent.ASSUME_MOBILE_WEBKIT||goog.userAgent.detectedMobile_;goog.userAgent.SAFARI=goog.userAgent.WEBKIT;
goog.userAgent.determinePlatform_=function(){var navigator=goog.userAgent.getNavigator();return navigator&&navigator.platform||""};goog.userAgent.PLATFORM=goog.userAgent.determinePlatform_();goog.userAgent.ASSUME_MAC=false;goog.userAgent.ASSUME_WINDOWS=false;goog.userAgent.ASSUME_LINUX=false;goog.userAgent.ASSUME_X11=false;goog.userAgent.PLATFORM_KNOWN_=goog.userAgent.ASSUME_MAC||goog.userAgent.ASSUME_WINDOWS||goog.userAgent.ASSUME_LINUX||goog.userAgent.ASSUME_X11;
goog.userAgent.initPlatform_=function(){goog.userAgent.detectedMac_=goog.string.contains(goog.userAgent.PLATFORM,"Mac");goog.userAgent.detectedWindows_=goog.string.contains(goog.userAgent.PLATFORM,"Win");goog.userAgent.detectedLinux_=goog.string.contains(goog.userAgent.PLATFORM,"Linux");goog.userAgent.detectedX11_=!!goog.userAgent.getNavigator()&&goog.string.contains(goog.userAgent.getNavigator()["appVersion"]||"","X11")};if(!goog.userAgent.PLATFORM_KNOWN_)goog.userAgent.initPlatform_();
goog.userAgent.MAC=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_MAC:goog.userAgent.detectedMac_;goog.userAgent.WINDOWS=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_WINDOWS:goog.userAgent.detectedWindows_;goog.userAgent.LINUX=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_LINUX:goog.userAgent.detectedLinux_;goog.userAgent.X11=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_X11:goog.userAgent.detectedX11_;
goog.userAgent.determineVersion_=function(){var version="",re;if(goog.userAgent.OPERA&&goog.global["opera"]){var operaVersion=goog.global["opera"].version;version=typeof operaVersion=="function"?operaVersion():operaVersion}else{if(goog.userAgent.GECKO)re=/rv\:([^\);]+)(\)|;)/;else if(goog.userAgent.IE)re=/MSIE\s+([^\);]+)(\)|;)/;else if(goog.userAgent.WEBKIT)re=/WebKit\/(\S+)/;if(re){var arr=re.exec(goog.userAgent.getUserAgentString());version=arr?arr[1]:""}}if(goog.userAgent.IE){var docMode=goog.userAgent.getDocumentMode_();
if(docMode>parseFloat(version))return String(docMode)}return version};goog.userAgent.getDocumentMode_=function(){var doc=goog.global["document"];return doc?doc["documentMode"]:undefined};goog.userAgent.VERSION=goog.userAgent.determineVersion_();goog.userAgent.compare=function(v1,v2){return goog.string.compareVersions(v1,v2)};goog.userAgent.isVersionCache_={};
goog.userAgent.isVersion=function(version){return goog.userAgent.isVersionCache_[version]||(goog.userAgent.isVersionCache_[version]=goog.string.compareVersions(goog.userAgent.VERSION,version)>=0)};goog.provide("goog.events.BrowserFeature");goog.require("goog.userAgent");goog.events.BrowserFeature={HAS_W3C_BUTTON:!goog.userAgent.IE||goog.userAgent.isVersion("9"),SET_KEY_CODE_TO_PREVENT_DEFAULT:goog.userAgent.IE&&!goog.userAgent.isVersion("8")};goog.provide("goog.events.Event");goog.require("goog.Disposable");goog.events.Event=function(type,opt_target){goog.Disposable.call(this);this.type=type;this.target=opt_target;this.currentTarget=this.target};goog.inherits(goog.events.Event,goog.Disposable);goog.events.Event.prototype.disposeInternal=function(){delete this.type;delete this.target;delete this.currentTarget};goog.events.Event.prototype.propagationStopped_=false;goog.events.Event.prototype.returnValue_=true;
goog.events.Event.prototype.stopPropagation=function(){this.propagationStopped_=true};goog.events.Event.prototype.preventDefault=function(){this.returnValue_=false};goog.events.Event.stopPropagation=function(e){e.stopPropagation()};goog.events.Event.preventDefault=function(e){e.preventDefault()};goog.provide("goog.events.EventType");goog.require("goog.userAgent");
goog.events.EventType={CLICK:"click",DBLCLICK:"dblclick",MOUSEDOWN:"mousedown",MOUSEUP:"mouseup",MOUSEOVER:"mouseover",MOUSEOUT:"mouseout",MOUSEMOVE:"mousemove",SELECTSTART:"selectstart",KEYPRESS:"keypress",KEYDOWN:"keydown",KEYUP:"keyup",BLUR:"blur",FOCUS:"focus",DEACTIVATE:"deactivate",FOCUSIN:goog.userAgent.IE?"focusin":"DOMFocusIn",FOCUSOUT:goog.userAgent.IE?"focusout":"DOMFocusOut",CHANGE:"change",SELECT:"select",SUBMIT:"submit",INPUT:"input",PROPERTYCHANGE:"propertychange",DRAGSTART:"dragstart",
DRAGENTER:"dragenter",DRAGOVER:"dragover",DRAGLEAVE:"dragleave",DROP:"drop",TOUCHSTART:"touchstart",TOUCHMOVE:"touchmove",TOUCHEND:"touchend",TOUCHCANCEL:"touchcancel",CONTEXTMENU:"contextmenu",ERROR:"error",HELP:"help",LOAD:"load",LOSECAPTURE:"losecapture",READYSTATECHANGE:"readystatechange",RESIZE:"resize",SCROLL:"scroll",UNLOAD:"unload",HASHCHANGE:"hashchange",POPSTATE:"popstate"};goog.provide("goog.events.BrowserEvent");goog.provide("goog.events.BrowserEvent.MouseButton");goog.require("goog.events.BrowserFeature");goog.require("goog.events.Event");goog.require("goog.events.EventType");goog.require("goog.userAgent");goog.events.BrowserEvent=function(opt_e,opt_currentTarget){if(opt_e)this.init(opt_e,opt_currentTarget)};goog.inherits(goog.events.BrowserEvent,goog.events.Event);goog.events.BrowserEvent.MouseButton={LEFT:0,MIDDLE:1,RIGHT:2};
goog.events.BrowserEvent.IEButtonMap_=[1,4,2];goog.events.BrowserEvent.prototype.target=null;goog.events.BrowserEvent.prototype.currentTarget;goog.events.BrowserEvent.prototype.relatedTarget=null;goog.events.BrowserEvent.prototype.offsetX=0;goog.events.BrowserEvent.prototype.offsetY=0;goog.events.BrowserEvent.prototype.clientX=0;goog.events.BrowserEvent.prototype.clientY=0;goog.events.BrowserEvent.prototype.screenX=0;goog.events.BrowserEvent.prototype.screenY=0;
goog.events.BrowserEvent.prototype.button=0;goog.events.BrowserEvent.prototype.keyCode=0;goog.events.BrowserEvent.prototype.charCode=0;goog.events.BrowserEvent.prototype.ctrlKey=false;goog.events.BrowserEvent.prototype.altKey=false;goog.events.BrowserEvent.prototype.shiftKey=false;goog.events.BrowserEvent.prototype.metaKey=false;goog.events.BrowserEvent.prototype.platformModifierKey=false;goog.events.BrowserEvent.prototype.event_=null;
goog.events.BrowserEvent.prototype.init=function(e,opt_currentTarget){var type=this.type=e.type;this.target=e.target||e.srcElement;this.currentTarget=opt_currentTarget;var relatedTarget=e.relatedTarget;if(relatedTarget){if(goog.userAgent.GECKO)try{relatedTarget=relatedTarget.nodeName&&relatedTarget}catch(err){relatedTarget=null}}else if(type==goog.events.EventType.MOUSEOVER)relatedTarget=e.fromElement;else if(type==goog.events.EventType.MOUSEOUT)relatedTarget=e.toElement;this.relatedTarget=relatedTarget;
this.offsetX=e.offsetX!==undefined?e.offsetX:e.layerX;this.offsetY=e.offsetY!==undefined?e.offsetY:e.layerY;this.clientX=e.clientX!==undefined?e.clientX:e.pageX;this.clientY=e.clientY!==undefined?e.clientY:e.pageY;this.screenX=e.screenX||0;this.screenY=e.screenY||0;this.button=e.button;this.keyCode=e.keyCode||0;this.charCode=e.charCode||(type=="keypress"?e.keyCode:0);this.ctrlKey=e.ctrlKey;this.altKey=e.altKey;this.shiftKey=e.shiftKey;this.metaKey=e.metaKey;this.platformModifierKey=goog.userAgent.MAC?
e.metaKey:e.ctrlKey;this.event_=e;delete this.returnValue_;delete this.propagationStopped_};goog.events.BrowserEvent.prototype.isButton=function(button){if(!goog.events.BrowserFeature.HAS_W3C_BUTTON)if(this.type=="click")return button==goog.events.BrowserEvent.MouseButton.LEFT;else return!!(this.event_.button&goog.events.BrowserEvent.IEButtonMap_[button]);else return this.event_.button==button};
goog.events.BrowserEvent.prototype.stopPropagation=function(){goog.events.BrowserEvent.superClass_.stopPropagation.call(this);if(this.event_.stopPropagation)this.event_.stopPropagation();else this.event_.cancelBubble=true};
goog.events.BrowserEvent.prototype.preventDefault=function(){goog.events.BrowserEvent.superClass_.preventDefault.call(this);var be=this.event_;if(!be.preventDefault){be.returnValue=false;if(goog.events.BrowserFeature.SET_KEY_CODE_TO_PREVENT_DEFAULT)try{var VK_F1=112;var VK_F12=123;if(be.ctrlKey||be.keyCode>=VK_F1&&be.keyCode<=VK_F12)be.keyCode=-1}catch(ex){}}else be.preventDefault()};goog.events.BrowserEvent.prototype.getBrowserEvent=function(){return this.event_};
goog.events.BrowserEvent.prototype.disposeInternal=function(){goog.events.BrowserEvent.superClass_.disposeInternal.call(this);this.event_=null;this.target=null;this.currentTarget=null;this.relatedTarget=null};goog.provide("goog.events.EventWrapper");goog.events.EventWrapper=function(){};goog.events.EventWrapper.prototype.listen=function(src,listener,opt_capt,opt_scope,opt_eventHandler){};goog.events.EventWrapper.prototype.unlisten=function(src,listener,opt_capt,opt_scope,opt_eventHandler){};goog.provide("goog.events.Listener");goog.events.Listener=function(){};goog.events.Listener.counter_=0;goog.events.Listener.prototype.isFunctionListener_;goog.events.Listener.prototype.listener;goog.events.Listener.prototype.proxy;goog.events.Listener.prototype.src;goog.events.Listener.prototype.type;goog.events.Listener.prototype.capture;goog.events.Listener.prototype.handler;goog.events.Listener.prototype.key=0;goog.events.Listener.prototype.removed=false;
goog.events.Listener.prototype.callOnce=false;
goog.events.Listener.prototype.init=function(listener,proxy,src,type,capture,opt_handler){if(goog.isFunction(listener))this.isFunctionListener_=true;else if(listener&&listener.handleEvent&&goog.isFunction(listener.handleEvent))this.isFunctionListener_=false;else throw Error("Invalid listener argument");this.listener=listener;this.proxy=proxy;this.src=src;this.type=type;this.capture=!!capture;this.handler=opt_handler;this.callOnce=false;this.key=++goog.events.Listener.counter_;this.removed=false};
goog.events.Listener.prototype.handleEvent=function(eventObject){if(this.isFunctionListener_)return this.listener.call(this.handler||this.src,eventObject);return this.listener.handleEvent.call(this.listener,eventObject)};goog.provide("goog.structs.SimplePool");goog.require("goog.Disposable");goog.structs.SimplePool=function(initialCount,maxCount){goog.Disposable.call(this);this.maxCount_=maxCount;this.freeQueue_=[];this.createInitial_(initialCount)};goog.inherits(goog.structs.SimplePool,goog.Disposable);goog.structs.SimplePool.prototype.createObjectFn_=null;goog.structs.SimplePool.prototype.disposeObjectFn_=null;goog.structs.SimplePool.prototype.setCreateObjectFn=function(createObjectFn){this.createObjectFn_=createObjectFn};
goog.structs.SimplePool.prototype.setDisposeObjectFn=function(disposeObjectFn){this.disposeObjectFn_=disposeObjectFn};goog.structs.SimplePool.prototype.getObject=function(){if(this.freeQueue_.length)return this.freeQueue_.pop();return this.createObject()};goog.structs.SimplePool.prototype.releaseObject=function(obj){if(this.freeQueue_.length<this.maxCount_)this.freeQueue_.push(obj);else this.disposeObject(obj)};
goog.structs.SimplePool.prototype.createInitial_=function(initialCount){if(initialCount>this.maxCount_)throw Error("[goog.structs.SimplePool] Initial cannot be greater than max");for(var i=0;i<initialCount;i++)this.freeQueue_.push(this.createObject())};goog.structs.SimplePool.prototype.createObject=function(){if(this.createObjectFn_)return this.createObjectFn_();else return{}};
goog.structs.SimplePool.prototype.disposeObject=function(obj){if(this.disposeObjectFn_)this.disposeObjectFn_(obj);else if(goog.isObject(obj))if(goog.isFunction(obj.dispose))obj.dispose();else for(var i in obj)delete obj[i]};goog.structs.SimplePool.prototype.disposeInternal=function(){goog.structs.SimplePool.superClass_.disposeInternal.call(this);var freeQueue=this.freeQueue_;while(freeQueue.length)this.disposeObject(freeQueue.pop());delete this.freeQueue_};goog.provide("goog.userAgent.jscript");goog.require("goog.string");goog.userAgent.jscript.ASSUME_NO_JSCRIPT=false;
goog.userAgent.jscript.init_=function(){var hasScriptEngine="ScriptEngine"in goog.global;goog.userAgent.jscript.DETECTED_HAS_JSCRIPT_=hasScriptEngine&&goog.global["ScriptEngine"]()=="JScript";goog.userAgent.jscript.DETECTED_VERSION_=goog.userAgent.jscript.DETECTED_HAS_JSCRIPT_?goog.global["ScriptEngineMajorVersion"]()+"."+goog.global["ScriptEngineMinorVersion"]()+"."+goog.global["ScriptEngineBuildVersion"]():"0"};if(!goog.userAgent.jscript.ASSUME_NO_JSCRIPT)goog.userAgent.jscript.init_();
goog.userAgent.jscript.HAS_JSCRIPT=goog.userAgent.jscript.ASSUME_NO_JSCRIPT?false:goog.userAgent.jscript.DETECTED_HAS_JSCRIPT_;goog.userAgent.jscript.VERSION=goog.userAgent.jscript.ASSUME_NO_JSCRIPT?"0":goog.userAgent.jscript.DETECTED_VERSION_;goog.userAgent.jscript.isVersion=function(version){return goog.string.compareVersions(goog.userAgent.jscript.VERSION,version)>=0};goog.provide("goog.events.pools");goog.require("goog.events.BrowserEvent");goog.require("goog.events.Listener");goog.require("goog.structs.SimplePool");goog.require("goog.userAgent.jscript");goog.events.pools.getObject;goog.events.pools.releaseObject;goog.events.pools.getArray;goog.events.pools.releaseArray;goog.events.pools.getProxy;goog.events.pools.setProxyCallbackFunction;goog.events.pools.releaseProxy;goog.events.pools.getListener;goog.events.pools.releaseListener;goog.events.pools.getEvent;
goog.events.pools.releaseEvent;
(function(){var BAD_GC=goog.userAgent.jscript.HAS_JSCRIPT&&!goog.userAgent.jscript.isVersion("5.7");function getObject(){return{count_:0,remaining_:0}}function getArray(){return[]}var proxyCallbackFunction;goog.events.pools.setProxyCallbackFunction=function(cb){proxyCallbackFunction=cb};function getProxy(){var f=function(eventObject){return proxyCallbackFunction.call(f.src,f.key,eventObject)};return f}function getListener(){return new goog.events.Listener}function getEvent(){return new goog.events.BrowserEvent}if(!BAD_GC){goog.events.pools.getObject=
getObject;goog.events.pools.releaseObject=goog.nullFunction;goog.events.pools.getArray=getArray;goog.events.pools.releaseArray=goog.nullFunction;goog.events.pools.getProxy=getProxy;goog.events.pools.releaseProxy=goog.nullFunction;goog.events.pools.getListener=getListener;goog.events.pools.releaseListener=goog.nullFunction;goog.events.pools.getEvent=getEvent;goog.events.pools.releaseEvent=goog.nullFunction}else{goog.events.pools.getObject=function(){return objectPool.getObject()};goog.events.pools.releaseObject=
function(obj){objectPool.releaseObject(obj)};goog.events.pools.getArray=function(){return arrayPool.getObject()};goog.events.pools.releaseArray=function(obj){arrayPool.releaseObject(obj)};goog.events.pools.getProxy=function(){return proxyPool.getObject()};goog.events.pools.releaseProxy=function(obj){proxyPool.releaseObject(getProxy())};goog.events.pools.getListener=function(){return listenerPool.getObject()};goog.events.pools.releaseListener=function(obj){listenerPool.releaseObject(obj)};goog.events.pools.getEvent=
function(){return eventPool.getObject()};goog.events.pools.releaseEvent=function(obj){eventPool.releaseObject(obj)};var OBJECT_POOL_INITIAL_COUNT=0;var OBJECT_POOL_MAX_COUNT=600;var objectPool=new goog.structs.SimplePool(OBJECT_POOL_INITIAL_COUNT,OBJECT_POOL_MAX_COUNT);objectPool.setCreateObjectFn(getObject);var ARRAY_POOL_INITIAL_COUNT=0;var ARRAY_POOL_MAX_COUNT=600;var arrayPool=new goog.structs.SimplePool(ARRAY_POOL_INITIAL_COUNT,ARRAY_POOL_MAX_COUNT);arrayPool.setCreateObjectFn(getArray);var HANDLE_EVENT_PROXY_POOL_INITIAL_COUNT=
0;var HANDLE_EVENT_PROXY_POOL_MAX_COUNT=600;var proxyPool=new goog.structs.SimplePool(HANDLE_EVENT_PROXY_POOL_INITIAL_COUNT,HANDLE_EVENT_PROXY_POOL_MAX_COUNT);proxyPool.setCreateObjectFn(getProxy);var LISTENER_POOL_INITIAL_COUNT=0;var LISTENER_POOL_MAX_COUNT=600;var listenerPool=new goog.structs.SimplePool(LISTENER_POOL_INITIAL_COUNT,LISTENER_POOL_MAX_COUNT);listenerPool.setCreateObjectFn(getListener);var EVENT_POOL_INITIAL_COUNT=0;var EVENT_POOL_MAX_COUNT=600;var eventPool=new goog.structs.SimplePool(EVENT_POOL_INITIAL_COUNT,
EVENT_POOL_MAX_COUNT);eventPool.setCreateObjectFn(getEvent)}})();goog.provide("goog.object");goog.object.forEach=function(obj,f,opt_obj){for(var key in obj)f.call(opt_obj,obj[key],key,obj)};goog.object.filter=function(obj,f,opt_obj){var res={};for(var key in obj)if(f.call(opt_obj,obj[key],key,obj))res[key]=obj[key];return res};goog.object.map=function(obj,f,opt_obj){var res={};for(var key in obj)res[key]=f.call(opt_obj,obj[key],key,obj);return res};goog.object.some=function(obj,f,opt_obj){for(var key in obj)if(f.call(opt_obj,obj[key],key,obj))return true;return false};
goog.object.every=function(obj,f,opt_obj){for(var key in obj)if(!f.call(opt_obj,obj[key],key,obj))return false;return true};goog.object.getCount=function(obj){var rv=0;for(var key in obj)rv++;return rv};goog.object.getAnyKey=function(obj){for(var key in obj)return key};goog.object.getAnyValue=function(obj){for(var key in obj)return obj[key]};goog.object.contains=function(obj,val){return goog.object.containsValue(obj,val)};
goog.object.getValues=function(obj){var res=[];var i=0;for(var key in obj)res[i++]=obj[key];return res};goog.object.getKeys=function(obj){var res=[];var i=0;for(var key in obj)res[i++]=key;return res};goog.object.containsKey=function(obj,key){return key in obj};goog.object.containsValue=function(obj,val){for(var key in obj)if(obj[key]==val)return true;return false};goog.object.findKey=function(obj,f,opt_this){for(var key in obj)if(f.call(opt_this,obj[key],key,obj))return key;return undefined};
goog.object.findValue=function(obj,f,opt_this){var key=goog.object.findKey(obj,f,opt_this);return key&&obj[key]};goog.object.isEmpty=function(obj){for(var key in obj)return false;return true};goog.object.clear=function(obj){var keys=goog.object.getKeys(obj);for(var i=keys.length-1;i>=0;i--)goog.object.remove(obj,keys[i])};goog.object.remove=function(obj,key){var rv;if(rv=key in obj)delete obj[key];return rv};
goog.object.add=function(obj,key,val){if(key in obj)throw Error('The object already contains the key "'+key+'"');goog.object.set(obj,key,val)};goog.object.get=function(obj,key,opt_val){if(key in obj)return obj[key];return opt_val};goog.object.set=function(obj,key,value){obj[key]=value};goog.object.setIfUndefined=function(obj,key,value){return key in obj?obj[key]:obj[key]=value};goog.object.clone=function(obj){var res={};for(var key in obj)res[key]=obj[key];return res};
goog.object.transpose=function(obj){var transposed={};for(var key in obj)transposed[obj[key]]=key;return transposed};goog.object.PROTOTYPE_FIELDS_=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"];
goog.object.extend=function(target,var_args){var key,source;for(var i=1;i<arguments.length;i++){source=arguments[i];for(key in source)target[key]=source[key];for(var j=0;j<goog.object.PROTOTYPE_FIELDS_.length;j++){key=goog.object.PROTOTYPE_FIELDS_[j];if(Object.prototype.hasOwnProperty.call(source,key))target[key]=source[key]}}};
goog.object.create=function(var_args){var argLength=arguments.length;if(argLength==1&&goog.isArray(arguments[0]))return goog.object.create.apply(null,arguments[0]);if(argLength%2)throw Error("Uneven number of arguments");var rv={};for(var i=0;i<argLength;i+=2)rv[arguments[i]]=arguments[i+1];return rv};
goog.object.createSet=function(var_args){var argLength=arguments.length;if(argLength==1&&goog.isArray(arguments[0]))return goog.object.createSet.apply(null,arguments[0]);var rv={};for(var i=0;i<argLength;i++)rv[arguments[i]]=true;return rv};goog.provide("goog.events");goog.require("goog.array");goog.require("goog.debug.entryPointRegistry");goog.require("goog.debug.errorHandlerWeakDep");goog.require("goog.events.BrowserEvent");goog.require("goog.events.Event");goog.require("goog.events.EventWrapper");goog.require("goog.events.pools");goog.require("goog.object");goog.require("goog.userAgent");goog.events.listeners_={};goog.events.listenerTree_={};goog.events.sources_={};goog.events.onString_="on";goog.events.onStringMap_={};
goog.events.keySeparator_="_";goog.events.requiresSyntheticEventPropagation_;
goog.events.listen=function(src,type,listener,opt_capt,opt_handler){if(!type)throw Error("Invalid event type");else if(goog.isArray(type)){for(var i=0;i<type.length;i++)goog.events.listen(src,type[i],listener,opt_capt,opt_handler);return null}else{var capture=!!opt_capt;var map=goog.events.listenerTree_;if(!(type in map))map[type]=goog.events.pools.getObject();map=map[type];if(!(capture in map)){map[capture]=goog.events.pools.getObject();map.count_++}map=map[capture];var srcUid=goog.getUid(src);var listenerArray,
listenerObj;map.remaining_++;if(!map[srcUid]){listenerArray=map[srcUid]=goog.events.pools.getArray();map.count_++}else{listenerArray=map[srcUid];for(var i=0;i<listenerArray.length;i++){listenerObj=listenerArray[i];if(listenerObj.listener==listener&&listenerObj.handler==opt_handler){if(listenerObj.removed)break;return listenerArray[i].key}}}var proxy=goog.events.pools.getProxy();proxy.src=src;listenerObj=goog.events.pools.getListener();listenerObj.init(listener,proxy,src,type,capture,opt_handler);
var key=listenerObj.key;proxy.key=key;listenerArray.push(listenerObj);goog.events.listeners_[key]=listenerObj;if(!goog.events.sources_[srcUid])goog.events.sources_[srcUid]=goog.events.pools.getArray();goog.events.sources_[srcUid].push(listenerObj);if(src.addEventListener){if(src==goog.global||!src.customEvent_)src.addEventListener(type,proxy,capture)}else src.attachEvent(goog.events.getOnString_(type),proxy);return key}};
goog.events.listenOnce=function(src,type,listener,opt_capt,opt_handler){if(goog.isArray(type)){for(var i=0;i<type.length;i++)goog.events.listenOnce(src,type[i],listener,opt_capt,opt_handler);return null}var key=goog.events.listen(src,type,listener,opt_capt,opt_handler);var listenerObj=goog.events.listeners_[key];listenerObj.callOnce=true;return key};goog.events.listenWithWrapper=function(src,wrapper,listener,opt_capt,opt_handler){wrapper.listen(src,listener,opt_capt,opt_handler)};
goog.events.unlisten=function(src,type,listener,opt_capt,opt_handler){if(goog.isArray(type)){for(var i=0;i<type.length;i++)goog.events.unlisten(src,type[i],listener,opt_capt,opt_handler);return null}var capture=!!opt_capt;var listenerArray=goog.events.getListeners_(src,type,capture);if(!listenerArray)return false;for(var i=0;i<listenerArray.length;i++)if(listenerArray[i].listener==listener&&listenerArray[i].capture==capture&&listenerArray[i].handler==opt_handler)return goog.events.unlistenByKey(listenerArray[i].key);
return false};
goog.events.unlistenByKey=function(key){if(!goog.events.listeners_[key])return false;var listener=goog.events.listeners_[key];if(listener.removed)return false;var src=listener.src;var type=listener.type;var proxy=listener.proxy;var capture=listener.capture;if(src.removeEventListener){if(src==goog.global||!src.customEvent_)src.removeEventListener(type,proxy,capture)}else if(src.detachEvent)src.detachEvent(goog.events.getOnString_(type),proxy);var srcUid=goog.getUid(src);var listenerArray=goog.events.listenerTree_[type][capture][srcUid];
if(goog.events.sources_[srcUid]){var sourcesArray=goog.events.sources_[srcUid];goog.array.remove(sourcesArray,listener);if(sourcesArray.length==0)delete goog.events.sources_[srcUid]}listener.removed=true;listenerArray.needsCleanup_=true;goog.events.cleanUp_(type,capture,srcUid,listenerArray);delete goog.events.listeners_[key];return true};goog.events.unlistenWithWrapper=function(src,wrapper,listener,opt_capt,opt_handler){wrapper.unlisten(src,listener,opt_capt,opt_handler)};
goog.events.cleanUp_=function(type,capture,srcUid,listenerArray){if(!listenerArray.locked_)if(listenerArray.needsCleanup_){for(var oldIndex=0,newIndex=0;oldIndex<listenerArray.length;oldIndex++){if(listenerArray[oldIndex].removed){var proxy=listenerArray[oldIndex].proxy;proxy.src=null;goog.events.pools.releaseProxy(proxy);goog.events.pools.releaseListener(listenerArray[oldIndex]);continue}if(oldIndex!=newIndex)listenerArray[newIndex]=listenerArray[oldIndex];newIndex++}listenerArray.length=newIndex;
listenerArray.needsCleanup_=false;if(newIndex==0){goog.events.pools.releaseArray(listenerArray);delete goog.events.listenerTree_[type][capture][srcUid];goog.events.listenerTree_[type][capture].count_--;if(goog.events.listenerTree_[type][capture].count_==0){goog.events.pools.releaseObject(goog.events.listenerTree_[type][capture]);delete goog.events.listenerTree_[type][capture];goog.events.listenerTree_[type].count_--}if(goog.events.listenerTree_[type].count_==0){goog.events.pools.releaseObject(goog.events.listenerTree_[type]);
delete goog.events.listenerTree_[type]}}}};
goog.events.removeAll=function(opt_obj,opt_type,opt_capt){var count=0;var noObj=opt_obj==null;var noType=opt_type==null;var noCapt=opt_capt==null;opt_capt=!!opt_capt;if(!noObj){var srcUid=goog.getUid(opt_obj);if(goog.events.sources_[srcUid]){var sourcesArray=goog.events.sources_[srcUid];for(var i=sourcesArray.length-1;i>=0;i--){var listener=sourcesArray[i];if((noType||opt_type==listener.type)&&(noCapt||opt_capt==listener.capture)){goog.events.unlistenByKey(listener.key);count++}}}}else goog.object.forEach(goog.events.sources_,
function(listeners){for(var i=listeners.length-1;i>=0;i--){var listener=listeners[i];if((noType||opt_type==listener.type)&&(noCapt||opt_capt==listener.capture)){goog.events.unlistenByKey(listener.key);count++}}});return count};goog.events.getListeners=function(obj,type,capture){return goog.events.getListeners_(obj,type,capture)||[]};
goog.events.getListeners_=function(obj,type,capture){var map=goog.events.listenerTree_;if(type in map){map=map[type];if(capture in map){map=map[capture];var objUid=goog.getUid(obj);if(map[objUid])return map[objUid]}}return null};
goog.events.getListener=function(src,type,listener,opt_capt,opt_handler){var capture=!!opt_capt;var listenerArray=goog.events.getListeners_(src,type,capture);if(listenerArray)for(var i=0;i<listenerArray.length;i++)if(listenerArray[i].listener==listener&&listenerArray[i].capture==capture&&listenerArray[i].handler==opt_handler)return listenerArray[i];return null};
goog.events.hasListener=function(obj,opt_type,opt_capture){var objUid=goog.getUid(obj);var listeners=goog.events.sources_[objUid];if(listeners){var hasType=goog.isDef(opt_type);var hasCapture=goog.isDef(opt_capture);if(hasType&&hasCapture){var map=goog.events.listenerTree_[opt_type];return!!map&&!!map[opt_capture]&&objUid in map[opt_capture]}else if(!(hasType||hasCapture))return true;else return goog.array.some(listeners,function(listener){return hasType&&listener.type==opt_type||hasCapture&&listener.capture==
opt_capture})}return false};goog.events.expose=function(e){var str=[];for(var key in e)if(e[key]&&e[key].id)str.push(key+" = "+e[key]+" ("+e[key].id+")");else str.push(key+" = "+e[key]);return str.join("\n")};goog.events.getOnString_=function(type){if(type in goog.events.onStringMap_)return goog.events.onStringMap_[type];return goog.events.onStringMap_[type]=goog.events.onString_+type};
goog.events.fireListeners=function(obj,type,capture,eventObject){var map=goog.events.listenerTree_;if(type in map){map=map[type];if(capture in map)return goog.events.fireListeners_(map[capture],obj,type,capture,eventObject)}return true};
goog.events.fireListeners_=function(map,obj,type,capture,eventObject){var retval=1;var objUid=goog.getUid(obj);if(map[objUid]){map.remaining_--;var listenerArray=map[objUid];if(!listenerArray.locked_)listenerArray.locked_=1;else listenerArray.locked_++;try{var length=listenerArray.length;for(var i=0;i<length;i++){var listener=listenerArray[i];if(listener&&!listener.removed)retval&=goog.events.fireListener(listener,eventObject)!==false}}finally{listenerArray.locked_--;goog.events.cleanUp_(type,capture,
objUid,listenerArray)}}return Boolean(retval)};goog.events.fireListener=function(listener,eventObject){var rv=listener.handleEvent(eventObject);if(listener.callOnce)goog.events.unlistenByKey(listener.key);return rv};goog.events.getTotalListenerCount=function(){return goog.object.getCount(goog.events.listeners_)};
goog.events.dispatchEvent=function(src,e){if(goog.isString(e))e=new goog.events.Event(e,src);else if(!(e instanceof goog.events.Event)){var oldEvent=e;e=new goog.events.Event(e.type,src);goog.object.extend(e,oldEvent)}else e.target=e.target||src;var rv=1,ancestors;var type=e.type;var map=goog.events.listenerTree_;if(!(type in map))return true;map=map[type];var hasCapture=true in map;var targetsMap;if(hasCapture){ancestors=[];for(var parent=src;parent;parent=parent.getParentEventTarget())ancestors.push(parent);
targetsMap=map[true];targetsMap.remaining_=targetsMap.count_;for(var i=ancestors.length-1;!e.propagationStopped_&&i>=0&&targetsMap.remaining_;i--){e.currentTarget=ancestors[i];rv&=goog.events.fireListeners_(targetsMap,ancestors[i],e.type,true,e)&&e.returnValue_!=false}}var hasBubble=false in map;if(hasBubble){targetsMap=map[false];targetsMap.remaining_=targetsMap.count_;if(hasCapture)for(var i=0;!e.propagationStopped_&&i<ancestors.length&&targetsMap.remaining_;i++){e.currentTarget=ancestors[i];rv&=
goog.events.fireListeners_(targetsMap,ancestors[i],e.type,false,e)&&e.returnValue_!=false}else for(var current=src;!e.propagationStopped_&&current&&targetsMap.remaining_;current=current.getParentEventTarget()){e.currentTarget=current;rv&=goog.events.fireListeners_(targetsMap,current,e.type,false,e)&&e.returnValue_!=false}}return Boolean(rv)};
goog.events.protectBrowserEventEntryPoint=function(errorHandler){goog.events.handleBrowserEvent_=errorHandler.protectEntryPoint(goog.events.handleBrowserEvent_);goog.events.pools.setProxyCallbackFunction(goog.events.handleBrowserEvent_)};
goog.events.handleBrowserEvent_=function(key,opt_evt){if(!goog.events.listeners_[key])return true;var listener=goog.events.listeners_[key];var type=listener.type;var map=goog.events.listenerTree_;if(!(type in map))return true;map=map[type];var retval,targetsMap;if(goog.events.synthesizeEventPropagation_()){var ieEvent=opt_evt||goog.getObjectByName("window.event");var hasCapture=true in map;var hasBubble=false in map;if(hasCapture){if(goog.events.isMarkedIeEvent_(ieEvent))return true;goog.events.markIeEvent_(ieEvent)}var evt=
goog.events.pools.getEvent();evt.init(ieEvent,this);retval=true;try{if(hasCapture){var ancestors=goog.events.pools.getArray();for(var parent=evt.currentTarget;parent;parent=parent.parentNode)ancestors.push(parent);targetsMap=map[true];targetsMap.remaining_=targetsMap.count_;for(var i=ancestors.length-1;!evt.propagationStopped_&&i>=0&&targetsMap.remaining_;i--){evt.currentTarget=ancestors[i];retval&=goog.events.fireListeners_(targetsMap,ancestors[i],type,true,evt)}if(hasBubble){targetsMap=map[false];
targetsMap.remaining_=targetsMap.count_;for(var i=0;!evt.propagationStopped_&&i<ancestors.length&&targetsMap.remaining_;i++){evt.currentTarget=ancestors[i];retval&=goog.events.fireListeners_(targetsMap,ancestors[i],type,false,evt)}}}else retval=goog.events.fireListener(listener,evt)}finally{if(ancestors){ancestors.length=0;goog.events.pools.releaseArray(ancestors)}evt.dispose();goog.events.pools.releaseEvent(evt)}return retval}var be=new goog.events.BrowserEvent(opt_evt,this);try{retval=goog.events.fireListener(listener,
be)}finally{be.dispose()}return retval};goog.events.pools.setProxyCallbackFunction(goog.events.handleBrowserEvent_);goog.events.markIeEvent_=function(e){var useReturnValue=false;if(e.keyCode==0)try{e.keyCode=-1;return}catch(ex){useReturnValue=true}if(useReturnValue||e.returnValue==undefined)e.returnValue=true};goog.events.isMarkedIeEvent_=function(e){return e.keyCode<0||e.returnValue!=undefined};goog.events.uniqueIdCounter_=0;goog.events.getUniqueId=function(identifier){return identifier+"_"+goog.events.uniqueIdCounter_++};
goog.events.synthesizeEventPropagation_=function(){if(goog.events.requiresSyntheticEventPropagation_===undefined)goog.events.requiresSyntheticEventPropagation_=goog.userAgent.IE&&!goog.global["addEventListener"];return goog.events.requiresSyntheticEventPropagation_};goog.debug.entryPointRegistry.register(function(transformer){goog.events.handleBrowserEvent_=transformer(goog.events.handleBrowserEvent_);goog.events.pools.setProxyCallbackFunction(goog.events.handleBrowserEvent_)});goog.provide("goog.events.EventTarget");goog.require("goog.Disposable");goog.require("goog.events");goog.events.EventTarget=function(){goog.Disposable.call(this)};goog.inherits(goog.events.EventTarget,goog.Disposable);goog.events.EventTarget.prototype.customEvent_=true;goog.events.EventTarget.prototype.parentEventTarget_=null;goog.events.EventTarget.prototype.getParentEventTarget=function(){return this.parentEventTarget_};
goog.events.EventTarget.prototype.setParentEventTarget=function(parent){this.parentEventTarget_=parent};goog.events.EventTarget.prototype.addEventListener=function(type,handler,opt_capture,opt_handlerScope){goog.events.listen(this,type,handler,opt_capture,opt_handlerScope)};goog.events.EventTarget.prototype.removeEventListener=function(type,handler,opt_capture,opt_handlerScope){goog.events.unlisten(this,type,handler,opt_capture,opt_handlerScope)};
goog.events.EventTarget.prototype.dispatchEvent=function(e){return goog.events.dispatchEvent(this,e)};goog.events.EventTarget.prototype.disposeInternal=function(){goog.events.EventTarget.superClass_.disposeInternal.call(this);goog.events.removeAll(this);this.parentEventTarget_=null};goog.provide("crow.Graph");goog.require("crow.util.Assert");goog.require("crow.Algorithm");goog.require("goog.events.EventTarget");
crow.Graph=function(){this.nodes=[];this.map={};this.version="0";this.validator=new goog.events.EventTarget;this.width=0;this.height=0;this.addNode=function(node){node._initialize();if(node.getX&&node.getY){var x=node.getX(),y=node.getY();if(x+1>this.width)this.width=x+1;if(y+1>this.height)this.height=y+1}this.nodes.push(node);this.map[node.id]=node};this.removeNode=function(x,y,alsoInvalidate){if(typeof x==="number"){delete this.map[""+x+"_"+y];for(var i=0;i<this.nodes.length;i++){var node=this.nodes[i];
if(node.x==x&&node.y==y){this.nodes.splice(i,1);break}}if(alsoInvalidate)this.invalidate(x,y)}else delete this.map[x.id]};this.getNode=function(x_or_filter,y,orBlankNode){var node;if(typeof x_or_filter==="function")for(var i=0;i<this.nodes.length;i++){var n=this.nodes[i];if(x_or_filter.call(n)){node=n;break}}else if(typeof x_or_filter==="string")return this.map[x_or_filter];else{if(typeof x_or_filter!=="number")throw new Error("x coordinate not provided");if(typeof y!=="number")throw new Error("y coordinate not provided");
node=this.map[""+x_or_filter+"_"+y]}if(node)return node;else if(orBlankNode&&typeof x_or_filter==="number"){var node=new crow.BaseNode([x_or_filter,y]);node.isBlank=true;return node}else return undefined};this.getNodes=function(filter_or_options){switch(typeof filter_or_options){case "function":return this.getNodes({filter:filter_or_options});case "object":var start=filter_or_options.start||this.nodes[0];var algo=crow.Graph._lookupAlgorithm(filter_or_options.algorithm||"linear");if(!(algo.prototype instanceof
crow.algorithm.SearchAlgorithm))throw new Error("only compatible with SearchAlgorithms");return(new algo(this)).search(start,{filter:filter_or_options.filter});case "undefined":return this.nodes;default:throw new Error("unsupported object "+filter_or_options.toString());}};this.findGoal=function(opts){return crow.Graph.findGoal(opts,this)};this.invalidate=function(x,y,dx,dy){if(dx==0||dy==0)throw new Error("dx and dy can't be 0");if(dx&&dy)this.validator.dispatchEvent({type:"invalidateRegion",x:x,
y:y,dx:dx,dy:dy});else this.validator.dispatchEvent({type:"invalidatePoint",x:x,y:y})}};
crow.Graph.findGoal=function(opts,graph){crow.Algorithm.initializeDataStructures();var start=opts.start||graph&&graph.nodes[0];if(!start)throw new Error("To go somewhere you must know where you start...perhaps you meant to provide a start node?");var goal=opts.goal;var algo=crow.Graph._lookupAlgorithm(opts.algorithm)||crow.AlgorithmResolver.getAlgorithm();if(!(algo.prototype instanceof crow.algorithm.ShortestPathAlgorithm))throw new Error("only compatible with ShortestPathAlgorithms");opts.graph=
graph;return(new algo(graph)).findPath(start,goal,opts)};crow.Graph.algorithm={};crow.Graph.defaultAlgorithm={};
crow.Graph.fromTilePlane=function(tplane,callback){if(!window.Effect||!window.Effect.Port)throw new Error("EffectGames-specific extensions don't work anywhere else");if(!tplane)throw new Error("tplane is required");if(typeof callback!=="function")throw new Error("callback not provided or not a function");var g=new crow.Graph;for(var i=0,ilen=tplane.getMaxTileX();i<ilen;i++)for(var j=0,jlen=tplane.getMaxTileY();j<jlen;j++){var tile=tplane.lookupTile(i,j),tileData=tplane.lookupTile(i,j,true);var node=
callback(tile,tileData);if(node)g.addNode(node)}return g};crow.Graph.fromArray=function(array,callback){crow.assert(array instanceof Array,crow.assert.InvalidArgumentType("Array"));var graph=new crow.Graph;var x,y=0;for(var i=0;i<array.length;i++){x=0;var row=array[i];for(var ch_idx=0;ch_idx<row.length;ch_idx++){var ch=row.charAt(ch_idx);var node=callback(x,y,ch);if(node)graph.addNode(node);x++}y++}return graph};
crow.Graph.registerAlgorithm=function(algo){var alias=algo["alias"];if(!alias)throw new Error("No alias found for algorithm");crow.Graph.algorithm[alias]=algo};crow.Graph._lookupAlgorithm=function(alias_or_opts){var type=typeof alias_or_opts;if(type==="string"){var algo=crow.Graph.algorithm[alias_or_opts];if(algo)return algo;throw new Error("Algorithm `"+alias_or_opts+"` not found");}else if(type==="object"||type==="undefined"){var algo=crow.AlgorithmResolver.getAlgorithm(alias_or_opts);if(algo)return algo}return null};
crow.GraphUtil={distance:{euclidean:function(dx,dy){return Math.sqrt(Math.pow(dx,2)+Math.pow(dy,2))},manhattan:function(dx,dy){return Math.abs(dx)+Math.abs(dy)},chebyshev:function(dx,dy){return Math.max(Math.abs(dx),Math.abs(dy))},one:function(){return 1}}};crow.GraphUtil.distance.pythagoras=crow.GraphUtil.distance.euclidean;crow.GraphUtil.distance.maximum=crow.GraphUtil.distance.chebyshev;crow.GraphUtil.distance.manhattan8=crow.GraphUtil.distance.chebyshev;goog.provide("crow.AlgorithmResolver");
crow.AlgorithmResolver=new function(){this.getAlgorithm=function(opts){return this.getAlgorithms(opts).dequeue()};this.getAlgorithms=function(opts){if(!opts)opts={};if(typeof opts.heuristics_allowed==="undefined")opts.heuristics_allowed=true;var algos=crow.Graph.algorithm;var queue=new crow.structs.BucketPriorityQueue(crow.structs.BucketPriorityQueue.REVERSE_KEY_COMPARATOR);for(var i in algos){var algo=algos[i];var attributes=algo.attributes;if(attributes){var score=0;if(typeof opts.min_speed!=="undefined"&&
opts.min_speed>attributes.min_speed)score-=Infinity;else score+=attributes.min_speed;if(opts.moving_start&&!attributes.moving_start||opts.moving_goal&&!attributes.moving_goal||opts.unstable_graph&&!attributes.unstable_graph||!opts.heuristics_allowed&&attributes.heuristics_allowed||opts.goal_is_node&&!attributes.goal_is_node||opts.goal_is_callback&&!attributes.goal_is_callback)score-=Infinity;if(score>-Infinity)queue.enqueue(score,algo)}}return queue}};goog.provide("crow.algorithm.ShortestPathAlgorithm");goog.require("crow.Algorithm");crow.algorithm.ShortestPathAlgorithm=function(){};crow.algorithm.ShortestPathAlgorithm.prototype=new crow.Algorithm;crow.algorithm.ShortestPathAlgorithm.prototype.findPath=function(start,end,opts){this.wrapperNode=new crow.Algorithm.NodeMap};goog.provide("crow.Node");crow.Node=function(id){if(!id)id=""+Math.random();this.id=id};crow.Node.prototype.distanceAlgorithm=crow.GraphUtil.distance.manhattan;crow.Node.prototype.distanceToGoal=function(){throw new Error("This method (either distanceToGoal or distanceToNeighbor) was called, but is not implemented.  You must override this method in your own class to determine the distance between nodes.");};
crow.Node.prototype.distanceToNeighbor=function(){throw new Error("distanceToNeighbor must be overridden");};crow.Node.prototype.getNeighbors=function(graph){throw new Error("This method (getNeighbors) was called, but is not implemented.  You need to implement it so that the algorithm knows how to find the nodes reachable from the current node.");};goog.provide("crow.GridNode");goog.require("crow.Node");crow.GridNode=function(arr){crow.Node.apply(this);if(arr){this.x=arr[0];this.y=arr[1]}this.isBlank=false;this._initialized=false};crow.GridNode.prototype=new crow.Node;
crow.GridNode.prototype._initialize=function(){if(!this._initialized){this._initialized=true;var x=this.getX(),y=this.getY();if(typeof x!=="number")throw new Error("Node must have a valid x coord");if(typeof y!=="number")throw new Error("Node must have a valid y coord");x=Math.floor(x);y=Math.floor(y);this.x=x;this.y=y;this.generateId();delete this.getX;delete this.getY;if(this.distanceToNeighbor==crow.Node.prototype.distanceToNeighbor)this.distanceToNeighbor=this.distanceToGoal}};
crow.GridNode.prototype.getX=function(){return this.x};crow.GridNode.prototype.getY=function(){return this.y};crow.GridNode.prototype.distanceToGoal=function(other,actor){var dx=this.x-other.x,dy=this.y-other.y;return this.distanceAlgorithm(dx,dy)};crow.GridNode.prototype.generateId=function(){this.id=this.x+"_"+this.y;return this.id};
crow.GridNode.prototype.getNeighbors=function(graph,includeDiagonals,includeNulls){var ox=this.x,oy=this.y;var rawNeighbors=[];rawNeighbors.push(graph.getNode(ox+1,oy));if(includeDiagonals)rawNeighbors.push(graph.getNode(ox+1,oy+1));rawNeighbors.push(graph.getNode(ox,oy+1));if(includeDiagonals)rawNeighbors.push(graph.getNode(ox-1,oy+1));rawNeighbors.push(graph.getNode(ox-1,oy));if(includeDiagonals)rawNeighbors.push(graph.getNode(ox-1,oy-1));rawNeighbors.push(graph.getNode(ox,oy-1));if(includeDiagonals)rawNeighbors.push(graph.getNode(ox+
1,oy-1));var neighbors=[];for(var i=0;i<rawNeighbors.length;i++){var neighbor=rawNeighbors[i];if(neighbor)neighbors.push(neighbor);else if(includeNulls)neighbors.push(null)}return neighbors};goog.provide("crow.BaseNode");goog.require("crow.GridNode");crow.BaseNode=crow.GridNode;goog.provide("crow.algorithm.Path");goog.require("crow.BaseNode");goog.require("crow.util.Assert");
crow.algorithm.Path=function(opts){this.nodes=opts.nodes;this.start=opts.start;this.goal=opts.goal;this.end=opts.goal;this.length=opts.length;this.found=opts.found;this.algorithm=null;this.graph=null;this.actor=null;this._baked=true;if(opts.baked===false){this._baked=false;this.algorithm=opts.algorithm;this.graph=opts.graph;this.actor=opts.actor;if(this.graph){this.graph.validator.addEventListener("invalidatePoint",this._invalidatePoint,null,this);this.graph.validator.addEventListener("invalidateRegion",
this._invalidateRegion,null,this)}}};crow.algorithm.Path.prototype.copyTo=function(other){for(var i in this)other[i]=this[i]};crow.algorithm.Path.prototype._invalidatePoint=function(e){if(this._baked)return;this.algorithm._invalidatePoint(this,e)};crow.algorithm.Path.prototype._invalidateRegion=function(e){if(this._baked)return;this.algorithm._invalidateRegion(this,e)};
crow.algorithm.Path.prototype.advanceTo=function(index_or_node){crow.assert(typeof index_or_node==="number"||index_or_node instanceof crow.BaseNode,crow.assert.InvalidArgumentType("number or crow.BaseNode"));if(typeof index_or_node==="number"){crow.assert(index_or_node>=0&&index_or_node<this.nodes.length,crow.assert.IndexOutBounds(index_or_node));return this.advanceTo(this.nodes[index_or_node])}else{var x=index_or_node.x,y=index_or_node.y,i;var found=false;for(i=0;i<this.nodes.length;i++){var n=this.nodes[i];
if(n.x===x&&n.y===y){found=true;break}}if(found){this.start=index_or_node;this.found=false;if(this.algorithm.moveStart)this.algorithm.moveStart(this,index_or_node)}else{this.nodes=[index_or_node];this.found=false;this.end=null}}};
crow.algorithm.Path.prototype.moveTarget=function(newGoal){if(!this.algorithm.klass.attributes.moving_goal)throw new Error(crow.assert.IllegalMethodCall("moveGoal","This method is intended only to be used with algorithms that support moving targets."));this.goal=newGoal;this.found=false;if(this.algorithm.moveTarget)this.algorithm.moveTarget(this,newGoal)};crow.algorithm.Path.prototype.getNextNode=function(){return this.nodes[1]};
crow.algorithm.Path.prototype.continueCalculating=function(count){if(this._baked)throw new Error("Can't continue calculating a baked path.  Either pass {baked: false} to findGoal, or don't call .bake() on this path yet.");if(this.found)return true;return this.algorithm.continueCalculating(this,count)};
crow.algorithm.Path.prototype.bake=function(){this._baked=true;if(this.graph){this.graph.validator.removeEventListener("invalidatePoint",this._invalidatePoint);this.graph.validator.removeEventListener("invalidateRegion",this._invalidateRegion);this.graph=null}this.algorithm=null;this.actor=null};goog.provide("crow.algorithm.AStarAlgorithm");goog.require("crow.algorithm.ShortestPathAlgorithm");goog.require("crow.algorithm.Path");goog.require("crow.Graph");
(function(){crow.algorithm.AStarAlgorithm=function(graph){this.klass=crow.algorithm.AStarAlgorithm;this.graph=graph};crow.algorithm.AStarAlgorithm.prototype=new crow.algorithm.ShortestPathAlgorithm;crow.algorithm.AStarAlgorithm.prototype.findPath=function(start,goal,opts){crow.algorithm.ShortestPathAlgorithm.prototype.findPath.apply(this,arguments);if(typeof goal==="function")throw new Error("A* doesn't support using a callback to determine the goal");this._wrapperNode=new crow.Algorithm.NodeMap;
if(!opts)opts={};var actor=opts.actor;this.start=start;this.goal=goal;this.opts=opts;start=this._getWrapperNode(start);this.openSet=new crow.structs.BucketPriorityQueue;this.openSet.enqueue(0,start);start.g=0;start.h=start.innerNode.distanceToGoal(goal,actor);var found=false,currentNode;while(currentNode=this.openSet.dequeue()){if(currentNode.innerNode===goal){found=true;break}else if(currentNode.expanded)continue;currentNode.expanded=true;var neighbors=currentNode.innerNode.getNeighbors(this.graph);
for(var n=0;n<neighbors.length;n++){var neighbor=this._getWrapperNode(neighbors[n]);if(neighbor.expanded)continue;var newG=currentNode.g+currentNode.innerNode.distanceToNeighbor(neighbor.innerNode,actor);if(newG==Infinity)continue;if(!this.openSet.contains(neighbor)||newG<neighbor.g){neighbor.parent=currentNode;neighbor.g=newG;var h=neighbor.innerNode.distanceToGoal(goal,actor);neighbor.f=newG+h;this.openSet.enqueue(neighbor.f,neighbor)}}}var nodes=[];var pathOpts={nodes:nodes,start:start.innerNode,
goal:goal,length:null,recalculate:this.recalculate,algorithm:this,graph:opts.graph,baked:opts.baked||typeof opts.baked==="undefined"&&!opts.limit,actor:actor};if(found){var endNode=this._getWrapperNode(goal);nodes.unshift(endNode.innerNode);var node=endNode.parent;while(node){nodes.unshift(node.innerNode);node=node.parent}pathOpts.end=endNode.innerNode;pathOpts.length=endNode.g;pathOpts.found=true;return new crow.algorithm.Path(pathOpts)}else{pathOpts.end=null;pathOpts.length=Infinity;pathOpts.found=
false;return new crow.algorithm.Path(pathOpts)}};crow.algorithm.AStarAlgorithm.WrapperNode=function(node){this.innerNode=node;this.expanded=false;this.parent=null;this.g=Infinity;this.h=null;this.f=null};crow.algorithm.AStarAlgorithm.prototype._getWrapperNode=crow.Algorithm.wrapperNodeGetterTemplate(crow.algorithm.AStarAlgorithm.WrapperNode);crow.algorithm.AStarAlgorithm.attributes={min_speed:2,moving_start:false,moving_goal:false,unstable_graph:false,heuristics_allowed:true,goal_is_node:true,goal_is_callback:false};
crow.algorithm.AStarAlgorithm["alias"]="a*";crow.Graph.registerAlgorithm(crow.algorithm.AStarAlgorithm)})();goog.provide("crow.algorithm.BasicTraversalAlgorithm");goog.require("crow.Graph");goog.require("crow.algorithm.ShortestPathAlgorithm");
(function(){crow.algorithm.BasicTraversalAlgorithm=function(graph){this.klass=crow.algorithm.BasicTraversalAlgorithm;this.graph=graph};crow.algorithm.BasicTraversalAlgorithm.prototype=new crow.algorithm.ShortestPathAlgorithm;crow.algorithm.BasicTraversalAlgorithm.prototype.findPath=function(start,goal,opts){crow.algorithm.ShortestPathAlgorithm.prototype.findPath.apply(this,arguments);if(typeof opts=="undefined")opts={};start=this._getWrapperNode(start);start.distance=0;this.actor=opts.actor;var filter=
opts.filter;var found=false;var queue=[start],list=[],el;while(el=this.getNext(queue)){el.pending=false;el.expanded=true;list.push(el.innerNode);if(el.innerNode==goal){found=true;break}var neighbors=el.innerNode.getNeighbors(this.graph);if(opts.random)neighbors=neighbors.shuffle();for(var i=0;i<neighbors.length;i++){var neighbor=this._getWrapperNode(neighbors[i]);if(neighbor.expanded||neighbor.pending)continue;if(el.innerNode.distanceToNeighbor(neighbor.innerNode,this.actor)<Infinity&&(!filter||filter.call(this,
neighbor))){this.addNext(queue,neighbor);neighbor.pending=true;neighbor.parent=el;neighbor.distance=el.distance+1}}}this.start=start;this.goal=goal;this.list=list;return this.resolveResults(found)};crow.algorithm.BasicTraversalAlgorithm.prototype.getNext=function(col){throw new Error("must implement");};crow.algorithm.BasicTraversalAlgorithm.prototype.addNext=function(col,val){col.push(val)};crow.algorithm.BasicTraversalAlgorithm.prototype.resolveResults=function(found){var nodes=[];var pathOpts=
{nodes:nodes,start:this.start.innerNode,goal:this.goal,algorithm:this,graph:this.graph,baked:true,actor:this.actor,found:found};if(found){var endNode=this._getWrapperNode(this.goal);nodes.unshift(endNode.innerNode);var node=endNode.parent;while(node){nodes.unshift(node.innerNode);node=node.parent}pathOpts.end=endNode.innerNode;pathOpts.length=endNode.distance}else{pathOpts.end=null;pathOpts.length=Infinity}var path=new crow.algorithm.Path(pathOpts);path.allNodes=this.list;return path};crow.algorithm.BasicTraversalAlgorithm.WrapperNode=
function(node){this.innerNode=node;this.expanded=false;this.pending=false;this.parent=null;this.distance=Infinity};crow.algorithm.BasicTraversalAlgorithm.prototype._getWrapperNode=crow.Algorithm.wrapperNodeGetterTemplate(crow.algorithm.BasicTraversalAlgorithm.WrapperNode)})();goog.provide("crow.algorithm.BFSAlgorithm");goog.require("crow.Graph");goog.require("crow.algorithm.BasicTraversalAlgorithm");crow.algorithm.BFSAlgorithm=function(graph){this.klass=crow.algorithm.BFSAlgorithm;this.graph=graph};crow.algorithm.BFSAlgorithm.prototype=new crow.algorithm.BasicTraversalAlgorithm;crow.algorithm.BFSAlgorithm.prototype.getNext=function(col){return col.shift()};crow.algorithm.BFSAlgorithm["alias"]="bfs";crow.Graph.registerAlgorithm(crow.algorithm.BFSAlgorithm);goog.provide("crow.algorithm.SearchAlgorithm");goog.require("crow.Algorithm");crow.algorithm.SearchAlgorithm=function(){};crow.algorithm.SearchAlgorithm.prototype=new crow.Algorithm;crow.algorithm.SearchAlgorithm.prototype.search=function(start,opts){this.wrapperNode=new crow.Algorithm.NodeMap};goog.provide("crow.algorithm.BFSBasicAlgorithm");goog.require("crow.Graph");goog.require("crow.algorithm.SearchAlgorithm");goog.require("crow.algorithm.BFSAlgorithm");crow.algorithm.BFSBasicAlgorithm=function(graph){this.klass=crow.algorithm.BFSBasicAlgorithm;this.graph=graph};crow.algorithm.BFSBasicAlgorithm.prototype=new crow.algorithm.SearchAlgorithm;
crow.algorithm.BFSBasicAlgorithm.prototype.search=function(start,opts){var bfs=new crow.algorithm.BFSAlgorithm(this.graph);var path=bfs.findPath(start,null,opts);return path.allNodes};crow.algorithm.BFSBasicAlgorithm["alias"]="bfs_basic";crow.Graph.registerAlgorithm(crow.algorithm.BFSBasicAlgorithm);goog.provide("crow.algorithm.DFSAlgorithm");goog.require("crow.Graph");goog.require("crow.algorithm.BasicTraversalAlgorithm");crow.algorithm.DFSAlgorithm=function(graph){this.klass=crow.algorithm.DFSAlgorithm;this.graph=graph};crow.algorithm.DFSAlgorithm.prototype=new crow.algorithm.BasicTraversalAlgorithm;crow.algorithm.DFSAlgorithm.prototype.getNext=function(col){return col.pop()};crow.algorithm.DFSAlgorithm["alias"]="dfs";crow.Graph.registerAlgorithm(crow.algorithm.DFSAlgorithm);goog.provide("crow.algorithm.DijkstraAlgorithm");goog.require("crow.algorithm.ShortestPathAlgorithm");goog.require("crow.algorithm.Path");goog.require("crow.Graph");crow.algorithm.DijkstraAlgorithm=function(graph){this.klass=crow.algorithm.DijkstraAlgorithm;this.graph=graph};crow.algorithm.DijkstraAlgorithm.prototype=new crow.algorithm.ShortestPathAlgorithm;
crow.algorithm.DijkstraAlgorithm.prototype.findPath=function(start,goal,opts){crow.algorithm.ShortestPathAlgorithm.prototype.findPath.apply(this,arguments);this.visitedList=[];this.start=start;this.goal=goal;this.opts=opts||{};if(opts.limit)throw new Error("Dijkstra's doesn't support the `limit` option.");this.actor=opts.actor;this._getWrapperNode(start).distance=0;var endNode,found;if(typeof goal==="function"){this.mainLoop(start);endNode=this.determineClosestEndNode(goal);found=!!endNode}else{found=
this.mainLoop(start,goal);endNode=this._getWrapperNode(goal)}var path=[];if(endNode.distance<Infinity){path.unshift(endNode.innerNode);var node=endNode.previous;while(node){path.unshift(node.innerNode);node=node.previous}}return new crow.algorithm.Path({nodes:path,start:start,goal:goal,end:found?endNode.innerNode:null,length:found?endNode.distance:Infinity,found:found,algorithm:this,graph:opts.graph,baked:opts.baked||typeof opts.baked==="undefined"&&!opts.limit,actor:this.actor})};
crow.algorithm.DijkstraAlgorithm.prototype.determineClosestEndNode=function(goal){var closest,closestDistance=Infinity;for(var i=0;i<this.visitedList.length;i++){var node=this.visitedList[i];if(goal.call(node.innerNode)){var d=node.distance;if(d<closestDistance){closest=node;closestDistance=d}}}return closest};
crow.algorithm.DijkstraAlgorithm.prototype.mainLoop=function(node,endNode){var nextNodes=new crow.Algorithm.PriorityQueue;node=this._getWrapperNode(node);while(node!=null){var neighbors=node.innerNode.getNeighbors(this.graph);for(var n=0;n<neighbors.length;n++){var neighbor=this._getWrapperNode(neighbors[n]);if(neighbor.visited)continue;var neighborDistanceThroughMe=node.distance+node.innerNode.distanceToNeighbor(neighbor.innerNode,this.actor);var currentNeighborDistance=neighbor.distance;if(neighborDistanceThroughMe<
currentNeighborDistance){neighbor.distance=neighborDistanceThroughMe;neighbor.previous=node;currentNeighborDistance=neighborDistanceThroughMe}if(currentNeighborDistance<Infinity)nextNodes.enqueue(currentNeighborDistance,neighbor)}node.visited=true;this.visitedList.push(node);if(node.innerNode===endNode)return true;node=nextNodes.dequeue()}return false};crow.algorithm.DijkstraAlgorithm.WrapperNode=function(node){this.innerNode=node;this.visited=false;this.previous=null;this.distance=Infinity};
crow.algorithm.DijkstraAlgorithm.prototype._getWrapperNode=crow.Algorithm.wrapperNodeGetterTemplate(crow.algorithm.DijkstraAlgorithm.WrapperNode);crow.algorithm.DijkstraAlgorithm.attributes={min_speed:-2,moving_start:false,moving_goal:false,unstable_graph:false,heuristics_allowed:false,goal_is_node:true,goal_is_callback:true};crow.algorithm.DijkstraAlgorithm["alias"]="dijkstra";crow.Graph.registerAlgorithm(crow.algorithm.DijkstraAlgorithm);goog.provide("crow.algorithm.FRAStarAlgorithm");goog.require("crow.algorithm.ShortestPathAlgorithm");goog.require("crow.algorithm.BFSBasicAlgorithm");goog.require("crow.algorithm.Path");goog.require("crow.structs.BucketPriorityQueue");goog.require("crow.Graph");crow.algorithm.FRAStarAlgorithm=function(graph){this.klass=crow.algorithm.FRAStarAlgorithm;this.graph=graph};crow.algorithm.FRAStarAlgorithm.prototype=new crow.algorithm.ShortestPathAlgorithm;
crow.algorithm.FRAStarAlgorithm.prototype._invalidatePoint=function(path,invalidationEvent){crow.Algorithm.prototype._invalidatePoint.apply(this,arguments);this.reset()};
crow.algorithm.FRAStarAlgorithm.prototype.reset=function(){this.wrapperNode=new crow.Algorithm.NodeMap;this.start=this._getWrapperNode(this.start.innerNode);this.goal=this._getWrapperNode(this.goal.innerNode);this.iteration=1;this.start.initialize();this.start.g=0;this.evaluatedList=[];this.openSet=new crow.structs.BucketPriorityQueue;this.openSet.enqueue(0,this.start);this.state=1};crow.algorithm.FRAStarAlgorithm.prototype.ComputePriority=function(node){return node.g+node.innerNode.distanceToGoal(this.goal.innerNode)};
crow.algorithm.FRAStarAlgorithm.prototype.TestClosedList=function(node){return node==this.start||!!(node.expanded&&node.parent)};
crow.algorithm.FRAStarAlgorithm.prototype.ComputeShortestPath=function(){while(node=this.openSet.dequeue()){if(node.expanded)continue;node.expanded=true;var neighbors=node.innerNode.getNeighbors(this.graph,this.neighbors);for(var n=0;n<neighbors.length;n++){var neighbor=this._getWrapperNode(neighbors[n]);if(!this.TestClosedList(neighbor)){neighbor.initialize();var newG=node.g+node.innerNode.distanceToNeighbor(neighbor.innerNode);if(newG<neighbor.g){neighbor.g=newG;neighbor.parent=node;this.openSet.enqueue(this.ComputePriority(neighbor),
neighbor)}}}if(node==this.goal)return true}return false};
crow.algorithm.FRAStarAlgorithm.prototype.UpdateParent=function(clockwise){var node=this.cell;var neighbors=node.innerNode.getNeighbors(this.graph,this.diagonals);if(!clockwise)neighbors=neighbors.reverse();var parent=node.parent;var index=-1;for(var i=0;i<neighbors.length;i++)if(neighbors[i]==parent){index=i;break}if(index>=0)for(var i=0;i<neighbors.length;i++){var j=(i+index)%neighbors.length;var neighbor=this._getWrapperNode(neighbors[j]);if(neighbor.g==node.g+node.innerNode.distanceToNeighbor(neighbor.innerNode)&&
this.TestClosedList(neighbor)){neighbor.parent=node;this.cell=neighbor;return true}}return false};crow.algorithm.FRAStarAlgorithm.prototype.Step2=function(){this.cell=this.start;while(this.UpdateParent(false));this.cell=this.start;while(this.UpdateParent(true));};
crow.algorithm.FRAStarAlgorithm.prototype.Step3=function(){this.start.parent=null;var newStart=this.start,oldStart=this.previousStart;var bfs=new crow.algorithm.BFSBasicAlgorithm(this.graph);var getWrapper=this._getWrapperNode;var algo=this;var nodes=bfs.search(this.previousStart.innerNode,{filter:function(node){var a=getWrapper.call(algo,node).ancestors();return a.indexOf(oldStart)>=0&&a.indexOf(newStart)<0}});for(var i=0;i<nodes.length;i++){var node=this._getWrapperNode(nodes[i]);node.parent=null;
this.openSet.remove(node)}};
crow.algorithm.FRAStarAlgorithm.prototype.FindPerimeter=function(startNode,includingNode){var perimeter=[includingNode];var neighbors=startNode.innerNode.getNeighbors(this.graph,this.diagonals,true);var i;for(i=0;i<neighbors.length;i++){var neighbor=neighbors[i];if(neighbor==includingNode.innerNode)break}var node=startNode;for(var j=0;j<neighbors.length;j++){var k=(i+j)%neighbors.length;var neighbor=neighbors[k];if(neighbor){neighbor=this._getWrapperNode(neighbor);if(!this.TestClosedList(neighbor)){if(perimeter[perimeter.length-1]!=
neighbor)perimeter.push(neighbor)}else if(neighbor==startNode)break;else{node=neighbor;neighbors=node.innerNode.getNeighbors(this.graph,this.diagonals,true);i=k+3;j=-1}}}return perimeter};
crow.algorithm.FRAStarAlgorithm.prototype.Step5=function(){var perimeter=this.FindPerimeter(this.start,this.anchor);for(var i=0;i<perimeter.length;i++){var pNode=perimeter[i];this.openSet.enqueue(this.ComputePriority(pNode),pNode)}var initCell=this.InitializeCell;var algo=this;this.openSet.each(function(node){node.initialize()});var newNodes=[];this.openSet.each(function(node){var neighbors=node.innerNode.getNeighbors(algo.graph,algo.diagonals);for(var i=0;i<neighbors.length;i++){var neighbor=algo._getWrapperNode(neighbors[i]);
var newG=neighbor.g+neighbor.innerNode.distanceToNeighbor(node.innerNode);if(algo.TestClosedList(neighbor)&&node.g>newG){node.g=newG;node.parent=neighbor;newNodes.push(node)}}});for(var i=0;i<newNodes.length;i++){var node=newNodes[i];this.openSet.enqueue(this.ComputePriority(node),node)}};
crow.algorithm.FRAStarAlgorithm.prototype.findPath=function(start,goal,opts){if(!opts)opts={};crow.algorithm.ShortestPathAlgorithm.prototype.findPath.apply(this,arguments);start=this._getWrapperNode(start);goal=this._getWrapperNode(goal);this.start=start;this.goal=goal;this.opts=opts;this.reset();var path=this.resolveResults(this.opts,false);this.continueCalculating(path);return path};
crow.algorithm.FRAStarAlgorithm.prototype.resolveResults=function(opts,found){if(!opts)opts={};var pathOpts;if(found){var nodes=this.goal.ancestors(true).concat(this.goal.innerNode);pathOpts={nodes:nodes,start:this.start.innerNode,goal:this.goal.innerNode,found:true,length:this.goal.g,algorithm:this,graph:opts.graph,baked:opts.baked||typeof opts.baked==="undefined",actor:opts.actor}}else pathOpts={nodes:[],start:this.start.innerNode,goal:this.goal.innerNode,found:false,length:Infinity,algorithm:this,
graph:opts.graph,baked:opts.baked||typeof opts.baked==="undefined",actor:opts.actor};return new crow.algorithm.Path(pathOpts)};
crow.algorithm.FRAStarAlgorithm.prototype.updateStart=function(path){var foundStart=false;for(var i=0;i<path.nodes.length;i++)if(path.nodes[i]==this.start.innerNode){path.nodes.splice(0,i);foundStart=true;break}if(foundStart){var length=0;for(var i=0;i<path.nodes.length-1;i++)length+=path.nodes[i].distanceToNeighbor(path.nodes[i+1]);path.length=length}else throw new Error("Present (start) position not found on path!  FRA* only works if this agent follows the path towards the target.");};
crow.algorithm.FRAStarAlgorithm.prototype.continueCalculating=function(path){this.start=this._getWrapperNode(this.start);this.goal=this._getWrapperNode(this.goal);if(this.previousStart)this.previousStart=this._getWrapperNode(this.previousStart);if(this.previousGoal)this.previousGoal=this._getWrapperNode(this.previousGoal);while(true)switch(this.state){case 1:if(this.start==this.goal)this.state=true;else{var found=this.ComputeShortestPath();var newPath=this.resolveResults(null,found);path.found=found;
path.nodes=newPath.nodes;path.length=this.goal.g;if(found){this.openListIncomplete=false;this.state=3}else this.state=false}break;case 3:if(this.TestClosedList(this.goal))this.state=4;else this.state=5;break;case 4:var onPath=false;if(this.start!=this.goal)for(var i=0;i<path.nodes.length;i++){var node=path.nodes[i];if(node==this.goal.innerNode){this.updateStart(path);return true}}if(this.start==this.goal)this.state=true;else{if(this.newTarget){this.previousGoal=this.goal;this.goal=this._getWrapperNode(this.newTarget);
this.newTarget=null}if(!this.previousStart)this.previousStart=this.start;if(this.start!=this.previousStart){this.Step2();this.anchor=this.start.parent;this.Step3();this.openListIncomplete=true}this.state=3}break;case 5:if(this.openListIncomplete){this.iteration++;this.Step5()}this.state=1;break;case true:path.found=true;path.nodes=[path.goal];path.length=0;return true;case false:path.found=false;path.nodes=[];path.length=Infinity;return false}};
crow.algorithm.FRAStarAlgorithm.prototype.moveStart=function(path,newStart){this.previousStart=this.start;this.start=newStart};crow.algorithm.FRAStarAlgorithm.prototype.moveTarget=function(path,newTarget){this.previousGoal=this.goal;this.goal=newTarget};crow.algorithm.FRAStarAlgorithm.WrapperNode=function(node){this.innerNode=node;this.generatedIteration=0;this.expanded=false;this.g=null;this.parent=null};crow.algorithm.FRAStarAlgorithm.prototype._getWrapperNode=crow.Algorithm.wrapperNodeGetterTemplate(crow.algorithm.FRAStarAlgorithm.WrapperNode);
crow.algorithm.FRAStarAlgorithm.WrapperNode.prototype.initialize=function(){var algoIteration=this.algorithm.iteration;if(this.generatedIteration!=algoIteration){this.g=Infinity;this.generatedIteration=algoIteration;this.expanded=false}};crow.algorithm.FRAStarAlgorithm.WrapperNode.prototype.ancestors=function(useRawNodes){var ancestors=[];var p=this.parent;while(p){ancestors.unshift(useRawNodes?p.innerNode:p);p=p.parent}return ancestors};
crow.algorithm.FRAStarAlgorithm.attributes={min_speed:2,moving_start:true,moving_goal:true,unstable_graph:false,heuristics_allowed:true,goal_is_node:true,goal_is_callback:false};crow.algorithm.FRAStarAlgorithm["alias"]="fra*";crow.Graph.registerAlgorithm(crow.algorithm.FRAStarAlgorithm);goog.provide("crow.algorithm.LinearAlgorithm");goog.require("crow.algorithm.SearchAlgorithm");goog.require("crow.Graph");crow.algorithm.LinearAlgorithm=function(graph){this.klass=crow.algorithm.LinearAlgorithm;this.graph=graph};crow.algorithm.LinearAlgorithm.prototype=new crow.algorithm.SearchAlgorithm;
crow.algorithm.LinearAlgorithm.prototype.search=function(start,opts){if(!opts)opts={};var list;var nodes=this.graph.getNodes();if(opts.filter){list=[];for(var i=0;i<nodes.length;i++){var n=nodes[i];if(opts.filter.call(n))list.push(n)}}else list=nodes;return list};crow.algorithm.LinearAlgorithm["alias"]="linear";crow.Graph.registerAlgorithm(crow.algorithm.LinearAlgorithm);goog.provide("crow.structs.NDArray");goog.require("crow.util.Assert");crow.structs.NDArray=function(dimensions){this.arr=[];this.dimensions=dimensions};
crow.structs.NDArray.prototype.add=function(value){if(arguments.length-1!=this.dimensions)throw new Error(crow.assert.IncorrectArgumentCount(arguments.length,this.dimensions+1));var parentArray=this.arr,array=parentArray,l=arguments.length;for(var i=1;i<l-1;i++){array=parentArray[arguments[i]];if(typeof array==="undefined")array=parentArray[arguments[i]]=[];parentArray=array}array[arguments[l-1]]=value};
crow.structs.NDArray.prototype.get=function(){if(arguments.length!=this.dimensions)throw new crow.assert.IncorrectArgumentCount(arguments.length,this.dimensions);var arr=this.arr;for(var i=0;i<arguments.length&&typeof arr!=="undefined";i++)arr=arr[arguments[i]];return arr};crow.structs.NDArray.prototype.each=function(callback){for(var i=0;i<this.arr.length;i++){var el=this.arr[i];if(typeof el!=="undefined")this._each(callback,el,[i])}};
crow.structs.NDArray.prototype._each=function(callback,arr,path){if(arr instanceof Array&&path.length<=this.dimensions)for(var i=0;i<arr.length;i++){var newPath=path.slice(0).concat(i);var el=arr[i];if(typeof el!=="undefined")this._each(callback,el,newPath)}else{var args=path;args.unshift(arr);callback.apply(this,args)}};goog.provide("crow.algorithm.LPAStarAlgorithm");goog.require("crow.algorithm.ShortestPathAlgorithm");goog.require("crow.algorithm.Path");goog.require("crow.structs.BucketPriorityQueue");goog.require("crow.structs.NDArray");goog.require("crow.Graph");crow.algorithm.LPAStarAlgorithm=function(graph){this.klass=crow.algorithm.LPAStarAlgorithm;this.graph=graph};crow.algorithm.LPAStarAlgorithm.prototype=new crow.algorithm.ShortestPathAlgorithm;
crow.algorithm.LPAStarAlgorithm.prototype._CalculateKey=function(node){var startDist=Math.min(node.g,node.rhs);return[startDist+node.innerNode.distanceToGoal(this.goal.innerNode),startDist]};
crow.algorithm.LPAStarAlgorithm.prototype._UpdateVertex=function(node){if(node!=this.start){var neighbors=node.innerNode.getNeighbors(this.graph,this.diagonals);var bestScore=Infinity;for(var i=0;i<neighbors.length;i++){var neighbor=this._getWrapperNode(neighbors[i]);var score=neighbor.g+node.innerNode.distanceToNeighbor(neighbor.innerNode);if(score<bestScore)bestScore=score}node.rhs=bestScore}this.U.remove(node);if(node.g!=node.rhs)this.U.enqueue(this._CalculateKey(node),node)};
crow.algorithm.LPAStarAlgorithm.prototype.keyComp=function(k1,k2){if(k1[0]<k2[0]||k1[0]==k2[0]&&k1[1]<k2[1])return-1;if(k1[0]==k2[0]&&k1[1]==k2[1])return 0;return 1};crow.algorithm.LPAStarAlgorithm.prototype.updateNeighbors=function(node){var neighbors=node.innerNode.getNeighbors(this.graph,this.diagonals);for(var i=0;i<neighbors.length;i++)this._UpdateVertex(this._getWrapperNode(neighbors[i]))};crow.algorithm.LPAStarAlgorithm.prototype.debugGraph=function(){};
crow.algorithm.LPAStarAlgorithm.prototype.findPath=function(start,goal,opts){if(typeof goal==="function")throw new Error("LPA* doesn't support using a callback to determine the goal");if(!opts)opts={};this._wrapperNode=new crow.Algorithm.NodeMap;this.start=this._getWrapperNode(start);this.goal=this._getWrapperNode(goal);this.diagonals=opts.diagonals;this.U=new crow.structs.BucketPriorityQueue(this.keyComp);this.start.rhs=0;this.U.enqueue(this._CalculateKey(this.start),this.start);this.mainLoop();
var results=this.resolveResults();var pathOpts={nodes:results.nodes,start:this.start.innerNode,goal:this.goal.innerNode,found:results.found,length:results.length,recalculate:this.recalculate,algorithm:this,baked:opts.baked||typeof opts.baked==="undefined"&&!opts.limit,graph:opts.graph};return new crow.algorithm.Path(pathOpts)};
crow.algorithm.LPAStarAlgorithm.prototype.mainLoop=function(){while(this.U.length&&(this.keyComp(this.U.peekKey(),this._CalculateKey(this.goal))<0||this.goal.rhs!=this.goal.g)){var u=this.U.dequeue();if(u.g>u.rhs){u.g=u.rhs;this.updateNeighbors(u)}else{u.g=Infinity;this.updateNeighbors(u);this._UpdateVertex(u)}}};
crow.algorithm.LPAStarAlgorithm.prototype.resolveResults=function(){var nodes=[];var current=this.goal;var length=0;var failsafeMaximum=Infinity,count=0;if(this.graph)failSafeMaximum=this.graph.width*this.graph.height;while(current!=this.start&&current){nodes.unshift(current.innerNode);var neighbors=current.innerNode.getNeighbors(this.graph,this.diagonals);var bestScore=Infinity,bestNeighbor=null,distance=0,bestDistance=0;for(var i=0;i<neighbors.length;i++){var neighbor=this._getWrapperNode(neighbors[i]);
distance=current.innerNode.distanceToNeighbor(neighbor.innerNode);var score=neighbor.g+distance;if(score<bestScore){bestScore=score;bestNeighbor=neighbor;bestDistance=distance}}current=bestNeighbor;if(bestNeighbor)length+=bestDistance;count++;if(count>=failsafeMaximum){throw new Error("resolveResults won't terminate");break}}var found=current==this.start;if(!found)nodes=[];nodes.unshift(this.start.innerNode);return{nodes:nodes,length:length,found:found}};
crow.algorithm.LPAStarAlgorithm.prototype.recalculate=function(){var a=this.algorithm;return a.findPath(a.start,a.goal,a.opts)};
crow.algorithm.LPAStarAlgorithm.prototype._invalidatePoint=function(path,invalidationEvent){var x=invalidationEvent.x,y=invalidationEvent.y;if(!path.invalidatedPoints)path.invalidatedPoints=new crow.structs.NDArray(2);path.invalidatedPoints.add(true,x,y);var node=path.graph.getNode(x,y,true);var neighbors=node.getNeighbors(path.graph,path.algorithm.diagonals);for(var i=0;i<neighbors.length;i++){var neighbor=neighbors[i];path.invalidatedPoints.add(true,neighbor.x,neighbor.y)}path.found=false};
crow.algorithm.LPAStarAlgorithm.prototype.continueCalculating=function(path){if(path.invalidatedPoints){var algo=this;var getWrapperNode=this._getWrapperNode;path.invalidatedPoints.each(function(val,x,y){var n=algo.graph.getNode(x,y);if(n)algo._UpdateVertex(getWrapperNode.call(algo,n))});this.mainLoop();path.invalidatedPoints=new crow.structs.NDArray(2);var results=this.resolveResults();path.nodes=results.nodes;path.length=results.length;path.found=results.found}return path.found};
crow.algorithm.LPAStarAlgorithm.prototype._getWrapperNode=function(node){var w=this._wrapperNode.get(node);if(w)return w;w=new crow.algorithm.LPAStarAlgorithm.WrapperNode(node);this._wrapperNode.set(node,w);return w};crow.algorithm.LPAStarAlgorithm.WrapperNode=function(node){this.innerNode=node;this.rhs=Infinity;this.g=Infinity};crow.algorithm.LPAStarAlgorithm.attributes={min_speed:0,moving_start:false,moving_goal:false,unstable_graph:true,heuristics_allowed:true,goal_is_node:true,goal_is_callback:false};
crow.algorithm.LPAStarAlgorithm["alias"]="lpa*";crow.Graph.registerAlgorithm(crow.algorithm.LPAStarAlgorithm);goog.provide("crow.All");goog.require("crow.util.MonkeyPatches");goog.require("crow.Logger");goog.require("crow.Graph");goog.require("crow.Algorithm");goog.require("crow.AlgorithmResolver");goog.require("crow.algorithm.AStarAlgorithm");goog.require("crow.algorithm.BasicTraversalAlgorithm");goog.require("crow.algorithm.BFSAlgorithm");goog.require("crow.algorithm.BFSBasicAlgorithm");goog.require("crow.algorithm.DFSAlgorithm");goog.require("crow.algorithm.DijkstraAlgorithm");goog.require("crow.algorithm.FRAStarAlgorithm");
goog.require("crow.algorithm.LinearAlgorithm");goog.require("crow.algorithm.LPAStarAlgorithm");goog.require("crow.algorithm.SearchAlgorithm");goog.require("crow.algorithm.ShortestPathAlgorithm");goog.require("crow.BaseNode");goog.require("crow.structs.BucketPriorityQueue");goog.require("crow.structs.NDArray");
